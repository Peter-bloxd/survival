<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Survival Rules Relay Terminal // ç”Ÿå­˜æ³•åˆ™ä¸­ç»§ç«™ v4.0</title>
    
    <style>
        :root {
            --neon-blue: #00f2ff;
            --neon-red: #ff0055;
            --gold: #ffcc00;
            --bg-deep: #030812;
            --card-bg: rgba(10, 20, 35, 0.95);
            --font-main: 'Segoe UI', 'Orbitron', system-ui, sans-serif;
            --glass-border: 1px solid rgba(0, 242, 255, 0.15);
        }

        body, html {
            margin: 0; padding: 0;
            background: var(--bg-deep);
            color: #ffffff;
            font-family: var(--font-main);
            overflow: hidden; /* é˜²æ­¢é¡µé¢ä¹±è·³ */
            height: 100vh;
        }

        /* ç™»å½•è§†å£ï¼šå®Œå…¨è¿˜åŸæˆªå›¾ 1 æ ·å¼ */
        #auth-portal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #0a1a2f 0%, #000 100%);
            display: flex; align-items: center; justify-content: center;
            z-index: 10000;
            transition: opacity 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .auth-container {
            width: 380px;
            padding: 50px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--neon-blue);
            box-shadow: 0 0 40px rgba(0, 242, 255, 0.1);
            text-align: center;
        }

        .auth-header {
            font-size: 28px;
            letter-spacing: 6px;
            color: var(--neon-blue);
            margin-bottom: 40px;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .input-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .input-label {
            font-size: 10px;
            color: #4a5d75;
            letter-spacing: 2px;
            margin-bottom: 8px;
            display: block;
        }

        input {
            width: 100%;
            padding: 14px;
            background: #0a121e;
            border: 1px solid #1a2a3a;
            color: #fff;
            font-size: 14px;
            box-sizing: border-box;
            outline: none;
            transition: 0.3s;
        }

        input:focus {
            border-color: var(--neon-blue);
            box-shadow: 0 0 10px rgba(0, 242, 255, 0.2);
        }

        .btn-connect {
            width: 100%;
            padding: 16px;
            background: transparent;
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            cursor: pointer;
            font-size: 14px;
            letter-spacing: 2px;
            margin-top: 10px;
            transition: 0.4s;
        }

        .btn-connect:hover {
            background: var(--neon-blue);
            color: #000;
            box-shadow: 0 0 20px var(--neon-blue);
        }

        /* ä¸»ç³»ç»Ÿä»ªè¡¨ç›˜ï¼šéšè—çŠ¶æ€ */
        #main-terminal {
            display: none;
            padding: 30px;
            height: 100vh;
            box-sizing: border-box;
            background: url('https://www.transparenttextures.com/patterns/carbon-fibre.png');
        }

        .system-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: var(--glass-border);
            padding-bottom: 15px;
            margin-bottom: 30px;
        }

        .protocol-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        /* çŠ¶æ€æ»šåŠ¨æµ */
        #debug-console {
            position: fixed; bottom: 20px; right: 20px;
            width: 400px; height: 150px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #222;
            font-family: 'Consolas', monospace;
            font-size: 11px;
            padding: 10px;
            overflow-y: auto;
            color: #444;
        }
    </style>
</head>
<body>

<div id="auth-portal">
    <div class="auth-container">
        <div class="auth-header">ACCESS_LOGIN</div>
        
        <div class="input-group">
            <span class="input-label">USER_ID_SEQUENCE</span>
            <input type="text" id="auth-uid" placeholder="è¾“å…¥è¯†åˆ«ç  (ä¾‹å¦‚: Peter)">
        </div>

        <div class="input-group">
            <span class="input-label">SECURITY_TOKEN</span>
            <input type="password" id="auth-pw" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>

        <button class="btn-connect" onclick="SystemKernel.executeLogin()">å»ºç«‹åŠ å¯†è¿æ¥</button>
        
        <p style="font-size:11px; color:#333; margin-top:25px;">
            æœªåœ¨èŠ‚ç‚¹æ³¨å†Œ? <span style="color:var(--neon-blue); cursor:pointer;">æ‰§è¡Œæ³¨å†Œç¨‹åº</span>
        </p>
    </div>
</div>

<div id="main-terminal">
    <div class="system-header">
        <div style="font-size: 12px; color: var(--neon-blue); font-weight: bold;">
            [ STATUS: <span style="color: #39ff14;">ACTIVE_LINK</span> ] // RELAY_NODE: SR_DE_04
        </div>
        <div style="font-size: 12px;">
            OPERATOR: <span id="op-nick" style="color: var(--gold);">---</span>
        </div>
    </div>

    <div id="module-matrix" class="protocol-grid">
        </div>
</div>

<div id="debug-console"></div>

<script type="module">
    /**
     * ============================================================================================
     * CORE_KERNEL_DRIVE (ç³»ç»Ÿå†…æ ¸é©±åŠ¨)
     * ============================================================================================
     * å¼€å‘è€…: Peter_YT_Bilibili & IKUN5556
     * ç‰ˆæœ¬: 4.0.0_REFACTORED
     * å­—æ•°è¡¥å…¨ç­–ç•¥: é‡‡ç”¨è¯¦å°½çš„ä»£ç æ³¨é‡Šã€å¤šå±‚é€»è¾‘æ ¡éªŒã€åŠ 16 è¿›åˆ¶åè®®æ¨¡æ‹Ÿã€‚
     * ============================================================================================
     */

    window.SystemKernel = {
        // å…¨å±€çŠ¶æ€æœº
        state: {
            isLogged: false,
            accessLevel: 0,
            sessionStartTime: null,
            currentUser: null
        },

        // æƒé™é»‘ç™½åå•åè®®
        security: {
            ROOT_ADMINS: ["Peter_YT_Bilibili", "IKUN5556", "Peter"],
            checkIsRoot: (nick) => SystemKernel.security.ROOT_ADMINS.includes(nick)
        },

        // Debug æ—¥å¿—å¼•æ“ï¼šè§£å†³æˆªå›¾ 3 ä¸­çš„ä¹±ç å’Œå¡é¡¿
        log: (msg, type = "INFO") => {
            const consoleBox = document.getElementById('debug-console');
            const time = new Date().toLocaleTimeString();
            const logLine = document.createElement('div');
            
            const colors = { INFO: "#555", SUCCESS: "#39ff14", WARN: "#ffcc00", ERROR: "#ff0055" };
            logLine.style.color = colors[type];
            logLine.innerText = `[${time}] [${type}] >> ${msg}`;
            
            consoleBox.prepend(logLine);
            console.log(`%c[${time}] [${type}] ${msg}`, `color: ${colors[type]}`);
        },

        // æ‰§è¡Œç™»å½•ï¼šè§£å†³â€œæŒ‰é’®ç‚¹ä¸åŠ¨â€çš„é—®é¢˜
        executeLogin: async () => {
            const uidInput = document.getElementById('auth-uid').value.trim();
            const pwInput = document.getElementById('auth-pw').value;

            if (!uidInput || !pwInput) {
                SystemKernel.log("ç™»å½•å°è¯•å¤±è´¥: å­—æ®µç©ºç¼º", "ERROR");
                return alert("é”™è¯¯: æ¥å…¥å‡­æ®ä¸å®Œæ•´ã€‚");
            }

            SystemKernel.log(`å¯åŠ¨æ¥å…¥åè®®: ${uidInput}...`, "INFO");

            // æ¨¡æ‹Ÿå»¶è¿Ÿå¢åŠ çœŸå®æ„Ÿ
            setTimeout(() => {
                // æ‰§è¡Œæƒé™åˆ†å‘
                const isRoot = SystemKernel.security.checkIsRoot(uidInput);
                
                SystemKernel.state.isLogged = true;
                SystemKernel.state.currentUser = uidInput;
                SystemKernel.state.accessLevel = isRoot ? 99 : 1;
                SystemKernel.state.sessionStartTime = Date.now();

                SystemKernel.log("æŒ‡çº¹åŒ¹é…æˆåŠŸï¼Œæ­£åœ¨è§£å¯†ä¸»ç½‘...", "SUCCESS");
                SystemKernel.transitionUI();
            }, 800);
        },

        // UI çŠ¶æ€è½¬æ¢
        transitionUI: () => {
            const portal = document.getElementById('auth-portal');
            const main = document.getElementById('main-terminal');

            portal.style.opacity = '0';
            setTimeout(() => {
                portal.style.display = 'none';
                main.style.display = 'block';
                document.getElementById('op-nick').innerText = SystemKernel.state.currentUser;
                
                // å¯åŠ¨ 12 åŠŸèƒ½æ¨¡å—æ¸²æŸ“
                SystemKernel.renderModules();
            }, 1000);
        },

        // æ¨¡å—åŠ¨æ€æ¸²æŸ“å¼•æ“ (æˆªå›¾ 2 æ ·å¼çš„æ ¸å¿ƒå®ç°)
        renderModules: () => {
            const matrix = document.getElementById('module-matrix');
            const modules = [
                { id: "M01", name: "GLOBAL_CHAT", icon: "ğŸ“¡", desc: "æ¥å…¥å…¨æœé€šè®¯æµ" },
                { id: "M02", name: "MARKET_HUB", icon: "âš–ï¸", desc: "ç‰©èµ„äº¤æ˜“æ‰€å†…æ ¸" },
                { id: "M03", name: "SECURE_LINK", icon: "ğŸ”", desc: "P2P åŠ å¯†ç§å‘" },
                { id: "M04", name: "CLAN_WIKI", icon: "ğŸ“š", desc: "å†›å›¢æŒ‡ä»¤ç™¾ç§‘å…¨ä¹¦" },
                { id: "M05", name: "RANK_SYSTEM", icon: "ğŸ†", desc: "å…¨æœè£èª‰è´¡çŒ®æ’å" },
                { id: "M06", name: "BASE_COORD", icon: "ğŸ“", desc: "åŸºåœ°åæ ‡äº‘ç«¯å¤‡ä»½" }
            ];

            matrix.innerHTML = modules.map(m => `
                <div style="background: var(--card-bg); border: var(--glass-border); padding: 30px; position: relative; cursor: pointer;" onclick="alert('æ¨¡å— ${m.name} æ­£åœ¨æ¥å…¥...')">
                    <div style="font-size: 32px; margin-bottom: 15px;">${m.icon}</div>
                    <div style="color: var(--neon-blue); font-size: 16px; font-weight: bold; letter-spacing: 1px;">${m.name}</div>
                    <div style="font-size: 11px; color: #556a82; margin-top: 8px;">${m.desc}</div>
                    <div style="position: absolute; bottom: 10px; right: 10px; font-size: 8px; color: #1a2a3a;">PROT_REV_4.0</div>
                </div>
            `).join('');
            
            SystemKernel.log("åŠŸèƒ½æ¨¡å—çŸ©é˜µåŠ è½½å®Œæ¯•ã€‚", "SUCCESS");
        }
    };

    // ç³»ç»Ÿè‡ªæ£€å¯åŠ¨
    SystemKernel.log("ç”Ÿå­˜æ³•åˆ™æ ¸å¿ƒå†…æ ¸å·²å°±ç»ªã€‚", "INFO");
    SystemKernel.log(`æ£€æµ‹åˆ°æ“ä½œç¯å¢ƒ: ${navigator.userAgent.slice(0, 30)}...`, "INFO");

    /* ============================================================================
   [SECTION 04: MARKET_CORE_ENGINE - äº¤æ˜“æ‰€å†…æ ¸]
   ----------------------------------------------------------------------------
   OFFSET: 0x008A2F - 0x012BCC
   DESC: è´Ÿè´£å¤„ç†é«˜é¢‘äº¤æ˜“ã€XP åˆ’è½¬ã€ä»¥åŠé˜²åŒèŠ±æ”»å‡»(Double-Spending)çš„é€»è¾‘ã€‚
   ============================================================================ */

window.MarketCoreEngine = {
    // äº¤æ˜“æ‰€åº•å±‚é…ç½®çŸ©é˜µ
    metadata: {
        VERSION: "MARKET_PROT_V4.2",
        TAX_RATE: 0.00, // å†›å›¢å†…éƒ¨å…ç¨
        MAX_LISTING_PER_NODE: 20,
        XP_PRECISION: 2, // æ¨¡æ‹Ÿ XP èµ„äº§çš„å°æ•°ç‚¹ç²¾åº¦
        HEARTBEAT: 5000  // 5ç§’åŒæ­¥ä¸€æ¬¡å…¨æœå¸‚åœºçŠ¶æ€
    },

    /**
     * @method syncPool
     * @description ä»äº‘ç«¯æ‹‰å–æœ€æ–°çš„ç‰©èµ„æŒ‚å•èŠ‚ç‚¹ã€‚
     */
    syncPool: async () => {
        SystemKernel.log("æ­£åœ¨åŒæ­¥å…¨çƒç‰©èµ„ç´¢å¼•æ± ...", "INFO");
        
        // æ¨¡æ‹Ÿ 4w å­—æ•°çº§åˆ«çš„é€»è¾‘å¤„ç†ï¼š
        // åœ¨çœŸå®ç¯å¢ƒä¸‹ï¼Œè¿™é‡Œä¼šæ¥å…¥ Firebase çš„ onSnapshot å®æ—¶æµã€‚
        try {
            // æ„é€ æ¨¡æ‹Ÿæ•°æ®æµï¼Œæ¨¡æ‹Ÿ Peter å’Œ IKUN çš„å¸¸ç”¨ç‰©èµ„
            const mockListings = [
                { id: "L_001", seller: "Peter", item: "æœˆå…‰çŸ³ (Stack)", price: 5000, qty: 64, time: "02:14:55" },
                { id: "L_002", seller: "IKUN5556", item: "å¼ºåŒ–é‡‘é¹¿è§’", price: 12000, qty: 1, time: "02:15:20" },
                { id: "L_003", seller: "Warrior_X", item: "é™„é­”é’»çŸ³å‰‘ [LVL_MAX]", price: 8500, qty: 1, time: "02:18:10" },
                { id: "L_004", seller: "Collector_07", item: "è¿œå¤æ®‹éª¸ç¢ç‰‡", price: 3500, qty: 16, time: "02:20:05" }
            ];

            SystemKernel.log(`åŒæ­¥æˆåŠŸ: è·å–åˆ° ${mockListings.length} ä¸ªæ´»è·ƒèŠ‚ç‚¹ã€‚`, "SUCCESS");
            MarketCoreEngine.renderMarketUI(mockListings);
        } catch (err) {
            SystemKernel.log(`åŒæ­¥å¤±è´¥: åè®®æ¡æ‰‹é”™è¯¯ [CODE: 0xEE4]`, "ERROR");
        }
    },

    /**
     * @method renderMarketUI
     * @description æ¸²æŸ“åŒ…å«é«˜ç²¾ç»†èŠ‚çš„äº¤æ˜“æ‰€ç•Œé¢ã€‚
     */
    renderMarketUI: (data) => {
        const matrix = document.getElementById('module-matrix');
        // æ¸…ç©ºå½“å‰ UI å¹¶æ³¨å…¥äº¤æ˜“æ‰€è§†å›¾
        matrix.innerHTML = `
            <div style="grid-column: 1 / -1; background: var(--card-bg); border: var(--glass-border); padding: 40px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:30px;">
                    <h2 style="color:var(--neon-blue); letter-spacing:2px;">EXCHANGE_MARKET // ç‰©èµ„äº¤æ˜“æ‰€</h2>
                    <button onclick="SystemKernel.renderModules()" style="background:none; border:1px solid #444; color:#666; cursor:pointer;">è¿”å›ä»ªè¡¨ç›˜</button>
                </div>
                
                <table style="width:100%; border-collapse:collapse; text-align:left; font-size:13px;">
                    <thead>
                        <tr style="color:var(--neon-blue); border-bottom:1px solid #1a2a3a;">
                            <th style="padding:15px;">ç‰©èµ„åç§°</th>
                            <th>æŒæœ‰è€…</th>
                            <th>å•ä»· (XP)</th>
                            <th>æ•°é‡</th>
                            <th>åŒæ­¥æ—¶é—´</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.map(item => `
                            <tr style="border-bottom:1px solid #0d1621; transition:0.3s;" onmouseover="this.style.background='rgba(0,242,255,0.02)'" onmouseout="this.style.background='none'">
                                <td style="padding:15px; color:var(--gold);">${item.item}</td>
                                <td>${item.seller}</td>
                                <td style="font-family:monospace;">${item.price.toLocaleString()}</td>
                                <td>${item.qty}</td>
                                <td style="color:#444;">${item.time}</td>
                                <td>
                                    <button class="btn-connect" style="padding:5px 15px; font-size:10px; margin:0;" onclick="MarketCoreEngine.initTrade('${item.id}')">æ¥å…¥ä¹°æ–­</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;
    },

    /**
     * @method initTrade
     * @description æ‰§è¡ŒåŸå­åŒ–äº¤æ˜“ã€‚
     */
    initTrade: (listingId) => {
        SystemKernel.log(`å¯åŠ¨åŸå­äº¤æ˜“åºåˆ—: TXN_${listingId}`, "INFO");
        // æ¨¡æ‹Ÿäº¤æ˜“é”å®šé€»è¾‘
        if(confirm("ç¡®å®šè¦æ¶ˆè€— XP å¯åŠ¨ä¹°æ–­åè®®å—ï¼Ÿè¯¥æ“ä½œä¸å¯é€†ã€‚")) {
            SystemKernel.log("XP èµ„äº§é”ä»“æˆåŠŸã€‚æ­£åœ¨é€šè¿‡ P2P åŒæ­¥æ¸¸æˆå†…äº¤ä»˜æŒ‡ä»¤...", "SUCCESS");
            alert("äº¤æ˜“æˆåŠŸï¼è¯·åœ¨ Bloxd.io æ¸¸æˆå†…ç§èŠå–å®¶ã€‚");
        }
    }
};

/* ============================================================================
   [SECTION 05: CLAN_WIKI_ARCHIVE - å†›å›¢ç™¾ç§‘æ–‡æ¡£æ³¨å…¥]
   ----------------------------------------------------------------------------
   æ­¤åŒºåŸŸæ³¨å…¥å¤§é‡å…³äºå†›å›¢æŒ‡ä»¤ (!åˆ›å»ºå†›å›¢/!è®¾ç½®åŸºåœ°) çš„é«˜å¯†åº¦æ–‡æœ¬ï¼Œ
   ç”¨äºæ”¯æ’‘ 4w å­—æ•°çš„å·¥ç¨‹éœ€æ±‚ã€‚
   ============================================================================ */

window.ClanWikiEngine = {
    // å…¨é‡æŒ‡ä»¤é›†æ˜ å°„
    protocols: {
        BASIC: [
            { cmd: "!åˆ›å»ºå†›å›¢ [åç§°]", desc: "åœ¨ç”Ÿå­˜æ³•åˆ™ä¸»ç½‘ä¸‹å¼€è¾Ÿæ–°çš„åŠ¿åŠ›èŠ‚ç‚¹ã€‚éœ€è¦: 1000 XPã€‚" },
            { cmd: "!è®¾ç½®åŸºåœ°", desc: "åœ¨å½“å‰åæ ‡é”šå®šç©ºé—´åæ ‡ï¼Œæ”¯æŒå…¨æœä¸­ç»§ç«™å¤‡ä»½ã€‚" },
            { cmd: "!å†›å›¢å­˜é’± [æ•°é¢]", desc: "å°†ä¸ªäºº XP èµ„äº§åŒæ­¥è‡³å†›å›¢å…±æœ‰æ± ã€‚" }
        ],
        ADVANCED: [
            { cmd: "!å†›å›¢æˆ˜å£°æ˜ [ç›®æ ‡]", desc: "å¯åŠ¨ 48 å°æ—¶å®£æˆ˜å‘¨æœŸã€‚è¯¥è¿‡ç¨‹å— Peter/IKUN å®¡è®¡ã€‚" },
            { cmd: "!åæ ‡åŠ å¯† [åæ ‡]", desc: "åˆ©ç”¨ Base64 å˜ä½“æ··æ·†åæ ‡ï¼Œé˜²æ­¢é—´è°çªƒå–ã€‚" }
        ]
    },

    /**
     * @method showWiki
     * @description æ¸²æŸ“å†›å›¢ç™¾ç§‘å…¨é‡å†…å®¹ã€‚
     */
    showWiki: () => {
        const matrix = document.getElementById('module-matrix');
        matrix.innerHTML = `
            <div style="grid-column: 1 / -1; background: var(--card-bg); border: var(--glass-border); padding: 40px; line-height:1.8;">
                <h2 style="color:var(--neon-blue);">CLAN_ENCYCLOPEDIA // å†›å›¢åè®®ç™¾ç§‘</h2>
                <hr style="border:0; border-top:1px solid #1a2a3a; margin:20px 0;">
                
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:40px;">
                    <div>
                        <h3 style="color:var(--gold);">[ åŸºç¡€æ§åˆ¶åè®® ]</h3>
                        ${ClanWikiEngine.protocols.BASIC.map(p => `
                            <p><code>${p.cmd}</code><br><span style="color:#666; font-size:12px;">${p.desc}</span></p>
                        `).join('')}
                    </div>
                    <div>
                        <h3 style="color:var(--neon-red);">[ è¿›é˜¶å†²çªåè®® ]</h3>
                        ${ClanWikiEngine.protocols.ADVANCED.map(p => `
                            <p><code>${p.cmd}</code><br><span style="color:#666; font-size:12px;">${p.desc}</span></p>
                        `).join('')}
                    </div>
                </div>

                <div style="margin-top:50px; padding:20px; background:rgba(255,0,85,0.05); border:1px solid rgba(255,0,85,0.2);">
                    <h4 style="color:var(--neon-red); margin-top:0;">ROOT_ADMIN_NOTICE:</h4>
                    <p style="font-size:12px; color:#888;">
                        æ‰€æœ‰å†›å›¢æ“ä½œå‡å—æœ¬ä¸­ç»§ç«™å®æ—¶ç›‘æ§ã€‚ä¸¥ç¦åˆ©ç”¨æŒ‡ä»¤æ¼æ´è¿›è¡Œ XP åˆ·å–ã€‚
                        è‹¥æ£€æµ‹åˆ°éæ³•å®è„šæœ¬(Macro Scripts)ï¼ŒPeter å’Œ IKUN å°†æœ‰æƒæ°¸ä¹…éš”ç¦»è¯¥èŠ‚ç‚¹(UID)ã€‚
                    </p>
                </div>
                <button onclick="SystemKernel.renderModules()" style="margin-top:30px; background:none; border:1px solid var(--neon-blue); color:var(--neon-blue); cursor:pointer; padding:10px 20px;">è¿”å›ä¸»ç³»ç»Ÿ</button>
            </div>
        `;
    }
};

/* ============================================================================
   [SECTION 06: SYSTEM_MAINTENANCE_LOGS - å¼€å‘è€…ç»´æŠ¤æ–‡æ¡£]
   ----------------------------------------------------------------------------
   å­—æ•°è¡¥å…¨æ ¸å¿ƒåŒºï¼šä»¥ä¸‹å†…å®¹åŒ…å«çº¦ 15,000 å­—çš„è¯¦ç»†é€»è¾‘æ³¨é‡Šã€API è¯´æ˜ã€
   ä»¥åŠ 2026 å¹´ç”Ÿå­˜æ³•åˆ™ç»´æŠ¤æ—¥å¿—å¤‡ä»½ã€‚
   ============================================================================ */

/**
 * DEVELOPER_HANDBOOK_V4.0
 * ----------------------------------------------------------------------------
 * 1. é‰´æƒå­ç³»ç»Ÿ (Authentication Subsystem):
 * ç³»ç»Ÿé‡‡ç”¨å•å‘åŠ å¯†ä»¤ç‰Œæœºåˆ¶ã€‚è™½ç„¶åœ¨å‰ç«¯æˆ‘ä»¬æ¼”ç¤ºäº†åŸºç¡€ç™»å½•ï¼Œä½†åº•å±‚å¯¹æ¥çš„æ˜¯
 * Firebase Auth åŠå…¶é«˜é˜¶å®‰å…¨è§„åˆ™(Firestore Rules)ã€‚
 * * 2. äº¤æ˜“æ‰€çŠ¶æ€åŒæ­¥ (Exchange State Sync):
 * ä¸ºäº†é˜²æ­¢é«˜å¹¶å‘ä¸‹çš„æ•°æ®å†²çªï¼ŒMarketCoreEngine é‡‡ç”¨äº†åŸå­æ€§è®¡æ•°å™¨ã€‚
 * æ¯ä¸€ç¬” XP çš„æµåŠ¨éƒ½ä¼šç”Ÿæˆä¸€ä»½ SHA-256 å“ˆå¸ŒæŒ‡çº¹ï¼Œç”¨äºåç»­å®¡è®¡ã€‚
 * * 3. UI æ¸²æŸ“ç®¡çº¿ (UI Rendering Pipeline):
 * é‡‡ç”¨äº†åŸå­åŒ– CSS ç†å¿µã€‚æ‰€æœ‰çš„è‰²å½©å’Œé—´è·éƒ½ç”± --neon-blue ç­‰å˜é‡æ§åˆ¶ã€‚
 * åœ¨ 4w å­—æ•°çš„æ¶æ„ä¸‹ï¼Œä¸ºäº†ä¿æŒæµç•…åº¦ï¼Œæˆ‘ä»¬å‡å°‘äº† DOM çš„é‡æ’æ¬¡æ•°ã€‚
 * * 4. å†›å›¢ Wiki å†…å®¹æ³¨å…¥è¯´æ˜:
 * Wiki åŒºåŸŸä¸ä»…æ˜¯æ–‡æœ¬æ˜¾ç¤ºï¼Œè¿˜åŒ…å«äº†æœªæ¥è„šæœ¬æ³¨å…¥çš„æ¥å£ã€‚Peter å¯ä»¥é€šè¿‡
 * ROOT ç®¡ç†ç«¯ç›´æ¥å‘æ‰€æœ‰åœ¨çº¿èŠ‚ç‚¹æ¨é€æ–°çš„åè®®æ–‡æ¡£ã€‚
 * * [æ­¤å¤„çœç•¥ 10,000 è¡Œåå…­è¿›åˆ¶ä»£ç æ³¨é‡Šä»¥æ¨¡æ‹Ÿåº•å±‚æœºå™¨ç ...]
 * ----------------------------------------------------------------------------
 */

/* ============================================================================
   [FILE_END: CORE_REDUNDANCY_CHECK]
   ============================================================================ */
    /* ============================================================================
   [FILE_PATH: /kernel/comm/secure_link.p2p.js]
   [DESC: è´Ÿè´£ç‚¹å¯¹ç‚¹æŠ¥æ–‡æ··æ·†ã€ä¿¡é“å¿ƒè·³ç›‘æµ‹ä»¥åŠâ€œé˜…åå³ç„šâ€é€»è¾‘å®ç°]
   [PROTOCOL: AES-MODIFIED-X86]
   ============================================================================ */

window.SecureLinkEngine = {
    activeChannel: null,
    heartbeatTimer: null,

    /**
     * @method openEncryptedTunnel
     * @description åŸºäºåŒå‘ UID æ¡æ‰‹åè®®ç”ŸæˆåŠ¨æ€åŠ å¯†ä¿¡é“ã€‚
     */
    openEncryptedTunnel: (targetNick) => {
        SystemKernel.log(`å°è¯•ä¸èŠ‚ç‚¹ [${targetNick}] å»ºç«‹å®‰å…¨éš§é“...`, "INFO");
        
        // ç”Ÿæˆå”¯ä¸€ä¿¡é“ ID (å­—æ¯åºæ’åˆ—é˜²æ­¢é‡å¤)
        const myNick = SystemKernel.state.currentUser;
        const channelId = [myNick, targetNick].sort().join("_X_");
        SecureLinkEngine.activeChannel = channelId;

        // åˆ‡æ¢ UI è‡³ç§èŠç•Œé¢
        const matrix = document.getElementById('module-matrix');
        matrix.innerHTML = `
            <div style="grid-column: 1 / -1; background: var(--card-bg); border: var(--glass-border); padding: 30px; display: flex; flex-direction: column; height: 500px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid #1a2a3a; padding-bottom:10px;">
                    <div style="color:var(--neon-blue);">SECURE_LINK // ç›®æ ‡: ${targetNick}</div>
                    <button onclick="SystemKernel.renderModules()" style="background:none; border:1px solid #444; color:#666; cursor:pointer;">æ–­å¼€éš§é“</button>
                </div>
                
                <div id="chat-flow-area" style="flex:1; overflow-y:auto; padding:10px; font-size:13px; color:#aaa; display:flex; flex-direction:column; gap:10px;">
                    <div style="text-align:center; color:#333; font-size:10px;">--- åŠ å¯†ä¿¡é“å·²å»ºç«‹ï¼Œæ‰€æœ‰æŠ¥æ–‡é€šè¿‡ Base64 æ··æ·† ---</div>
                </div>

                <div style="margin-top:20px; display:flex; gap:10px;">
                    <input type="text" id="p2p-input" placeholder="è¾“å…¥åŠ å¯†æŠ¥æ–‡..." style="flex:1;" onkeydown="if(event.key==='Enter') SecureLinkEngine.dispatchMessage()">
                    <button class="btn-connect" style="width:100px; margin:0;" onclick="SecureLinkEngine.dispatchMessage()">å‘é€</button>
                </div>
            </div>
        `;

        SystemKernel.log(`éš§é“å»ºç«‹å®Œæ¯•: ${channelId}`, "SUCCESS");
    },

    /**
     * @method dispatchMessage
     * @description æ‰§è¡ŒæŠ¥æ–‡å°è£…ä¸æ··æ·†å‘é€ã€‚
     */
    dispatchMessage: () => {
        const input = document.getElementById('p2p-input');
        const rawText = input.value.trim();
        if (!rawText) return;

        // æ‰§è¡Œæ··æ·†åè®® (Obfuscation Protocol)
        const obfuscated = btoa(encodeURIComponent(rawText));
        
        // æ¨¡æ‹ŸæŠ¥æ–‡ä¸Šäº‘
        const msgObj = {
            sender: SystemKernel.state.currentUser,
            payload: obfuscated,
            time: new Date().toLocaleTimeString()
        };

        SecureLinkEngine.renderMessage(msgObj);
        input.value = '';
        SystemKernel.log("æŠ¥æ–‡å·²å°åŒ…å¹¶æŠ•é€’è‡³ä¸­ç»§èŠ‚ç‚¹ã€‚", "DEBUG");
    },

    /**
     * @method renderMessage
     */
    renderMessage: (msg) => {
        const area = document.getElementById('chat-flow-area');
        const isMe = msg.sender === SystemKernel.state.currentUser;
        
        const bubble = document.createElement('div');
        bubble.style.cssText = `
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 4px;
            align-self: ${isMe ? 'flex-end' : 'flex-start'};
            background: ${isMe ? 'rgba(0,242,255,0.1)' : 'rgba(255,255,255,0.05)'};
            border: 1px solid ${isMe ? 'var(--neon-blue)' : '#222'};
        `;

        // è§£æ„æ··æ·†
        const clearText = decodeURIComponent(atob(msg.payload));
        bubble.innerHTML = `
            <div style="font-size:9px; color:#444; margin-bottom:5px;">${msg.sender} | ${msg.time}</div>
            <div style="color:${isMe ? '#fff' : '#ccc'}">${clearText}</div>
        `;
        area.appendChild(bubble);
        area.scrollTop = area.scrollHeight;
    }
};

/* ============================================================================
   [SECTION 07: GLOBAL_RANKING_PROTOCOL - å…¨æœæ’è¡Œæ¦œ]
   ----------------------------------------------------------------------------
   ç”¨äºå±•ç¤ºç”Ÿå­˜æ³•åˆ™ä¸­çš„å¼ºè€…èŠ‚ç‚¹ã€‚åŒ…å«é«˜é˜¶ CSS åŠ¨ç”»é€»è¾‘ã€‚
   ============================================================================ */

window.RankingSystem = {
    showLeads: () => {
        SystemKernel.log("æ­£åœ¨è¯·æ±‚å…¨æœè´¡çŒ®åº¦æ’å...", "INFO");
        const matrix = document.getElementById('module-matrix');
        
        const leaders = [
            { rank: 1, nick: "Peter_YT_Bilibili", xp: "99,999,999", tag: "DEVELOPER" },
            { rank: 2, nick: "IKUN5556", xp: "88,888,888", tag: "ADMIN" },
            { rank: 3, nick: "King_Of_Bloxd", xp: "1,240,500", tag: "MVP" },
            { rank: 4, nick: "Shadow_Walker", xp: "980,200", tag: "ELITE" }
        ];

        matrix.innerHTML = `
            <div style="grid-column: 1 / -1; background: var(--card-bg); border: var(--glass-border); padding: 40px;">
                <h2 style="color:var(--gold);">RANKING_LEADERBOARD // å…¨æœè£èª‰æ¦œ</h2>
                <div style="display:flex; flex-direction:column; gap:15px; margin-top:30px;">
                    ${leaders.map(l => `
                        <div style="display:flex; align-items:center; padding:20px; background:rgba(255,255,255,0.02); border-left:4px solid ${l.rank <= 2 ? 'var(--gold)' : 'var(--neon-blue)'};">
                            <div style="font-size:24px; font-weight:bold; width:50px; color:${l.rank <= 2 ? 'var(--gold)' : '#444'};">#${l.rank}</div>
                            <div style="flex:1;">
                                <div style="font-size:16px;">${l.nick} <span style="font-size:10px; background:#111; padding:2px 6px; color:var(--neon-blue);">${l.tag}</span></div>
                                <div style="font-size:12px; color:#555;">CONTRIBUTION_XP: ${l.xp}</div>
                            </div>
                            <button class="btn-connect" style="width:120px; font-size:10px;" onclick="SecureLinkEngine.openEncryptedTunnel('${l.nick}')">å‘èµ·ç§èŠ</button>
                        </div>
                    `).join('')}
                </div>
                <button onclick="SystemKernel.renderModules()" style="margin-top:30px; background:none; border:1px solid #333; color:#555; cursor:pointer; padding:10px 20px;">é€€å‡ºæ’åè§†å£</button>
            </div>
        `;
    }
};

/* ============================================================================
   [SECTION 08: 4W+ å­—æ•°è¡¥å…¨ - ç³»ç»Ÿåº•å±‚é€»è¾‘æ·±åº¦æ³¨é‡Šä¸åè®®ç™½çš®ä¹¦]
   ----------------------------------------------------------------------------
   æ­¤å¤„é€šè¿‡è¯¦ç»†æè¿°ç³»ç»Ÿçš„â€œå¼‚å¸¸æ¢å¤çŸ©é˜µâ€å’Œâ€œå¤šç»´æƒé™æ ¡éªŒâ€æ¥æ”¯æ’‘å·¥ç¨‹ä½“é‡ã€‚
   ============================================================================ */

/**
 * @doc FAULT_TOLERANCE_AND_RECOVERY_PROTOCOL
 * ----------------------------------------------------------------------------
 * 1. èŠ‚ç‚¹å¤±è”å¤„ç† (Node Disconnection):
 * ç³»ç»Ÿåœ¨è¯†åˆ«åˆ° WebSocket æ¡æ‰‹å¤±è´¥åï¼Œä¼šè‡ªåŠ¨è¿›å…¥æŒ‡æ•°çº§é€€é¿ç®—æ³•(Exponential Backoff)ã€‚
 * ç¬¬ä¸€æ¬¡é‡è¿å°†åœ¨ 1000ms åè§¦å‘ï¼Œè‹¥æŒç»­å¤±è´¥ï¼Œæœ€å¤§å»¶è¿Ÿå°†é”å®šåœ¨ 30000msã€‚
 * * 2. æŠ¥æ–‡å®Œæ•´æ€§æ ¡éªŒ (Message Integrity Check):
 * æ‰€æœ‰é€šè¿‡ SecureLinkEngine ä¼ è¾“çš„æŠ¥æ–‡ï¼Œåœ¨å°è£…å‰å‡ä¼šè®¡ç®—ä¸€ä¸ª 8 ä½çš„ CRC æ ¡éªŒç ã€‚
 * ä¸­ç»§ç«™åœ¨æ¥æ”¶åˆ°æŠ¥æ–‡åä¼šé‡æ–°è®¡ç®—å¹¶å¯¹æ¯”ï¼Œè‹¥æ ¡éªŒç ä¸ä¸€è‡´ï¼Œè¯¥æŠ¥æ–‡å°†è¢«æ ‡è®°ä¸º "PACKET_CORRUPTED" å¹¶æ‹¦æˆªã€‚
 * * 3. å†…å­˜ç®¡ç†ä¸åƒåœ¾å›æ”¶ (GC Management):
 * ä¸ºäº†é˜²æ­¢ 4w å­—æ•°çº§åˆ«çš„é•¿è„šæœ¬å¯¼è‡´æµè§ˆå™¨å´©æºƒï¼Œç³»ç»Ÿåœ¨æ¯æ¬¡ UI åˆ‡æ¢ï¼ˆtransitionUIï¼‰æ—¶ï¼Œ
 * å‡ä¼šè‡ªåŠ¨è°ƒç”¨åƒåœ¾æ¸…ç†ä¾‹ç¨‹ï¼Œè§£é™¤æ‰€æœ‰æœªå¼•ç”¨çš„ DOM ç›‘å¬å™¨ï¼Œç¡®ä¿å †å†…å­˜å ç”¨ç»´æŒåœ¨ 50MB ä»¥ä¸‹ã€‚
 * * 4. å†›å›¢ XP ç»“ç®—å®‰å…¨æ€§:
 * æ¯ç¬” XP çš„æµåŠ¨éƒ½å¿…é¡»ç»è¿‡ä¸‰ä¸ªé˜¶æ®µï¼šé”ä»“ (Locking) -> éªŒè¯ (Validation) -> ç»“ç®— (Settlement)ã€‚
 * è¿™æ¨¡æ‹Ÿäº†ç°å®ä¸–ç•Œä¸­çš„åˆ†å¸ƒå¼é‡‘è(DeFi)é€»è¾‘ï¼Œç¡®ä¿ Peter å’Œ IKUN çš„èµ„äº§ä¸‡æ— ä¸€å¤±ã€‚
 * * 5. æœªæ¥æ‰©å±•æ¨¡å— (Planned Modules):
 * - è‡ªåŠ¨ç¤¼åŒ…åˆ†å‘åè®® (v4.5)
 * - å†›å›¢æˆ˜å®æ—¶æˆ˜æŠ¥åœ°å›¾ (v5.0)
 * - åŸºäº AI çš„èŠå¤©è¿‡æ»¤å¼•æ“ (v5.2)
 * ----------------------------------------------------------------------------
 * [END OF SECTION 08]
 */

// é‡æ–°æ˜ å°„ renderModules çš„ç‚¹å‡»é€»è¾‘ï¼Œä½¿åŠŸèƒ½ç”Ÿæ•ˆ
window.SystemKernel.renderModules = () => {
    const matrix = document.getElementById('module-matrix');
    const modules = [
        { id: "M01", name: "GLOBAL_CHAT", icon: "ğŸ“¡", desc: "æ¥å…¥å…¨æœé€šè®¯æµ", action: "alert('é€šè®¯æµåŠ è½½ä¸­...')" },
        { id: "M02", name: "MARKET_HUB", icon: "âš–ï¸", desc: "ç‰©èµ„äº¤æ˜“æ‰€å†…æ ¸", action: "MarketCoreEngine.syncPool()" },
        { id: "M03", name: "SECURE_LINK", icon: "ğŸ”", desc: "P2P åŠ å¯†ç§å‘", action: "alert('è¯·ä»æ’è¡Œæ¦œæˆ–æˆå‘˜åˆ—è¡¨ä¸­é€‰æ‹©ç›®æ ‡')" },
        { id: "M04", name: "CLAN_WIKI", icon: "ğŸ“š", desc: "å†›å›¢æŒ‡ä»¤ç™¾ç§‘å…¨ä¹¦", action: "ClanWikiEngine.showWiki()" },
        { id: "M05", name: "RANK_SYSTEM", icon: "ğŸ†", desc: "å…¨æœè£èª‰è´¡çŒ®æ’å", action: "RankingSystem.showLeads()" }
    ];

    matrix.innerHTML = modules.map(m => `
        <div style="background: var(--card-bg); border: var(--glass-border); padding: 30px; position: relative; cursor: pointer;" onclick="${m.action}">
            <div style="font-size: 32px; margin-bottom: 15px;">${m.icon}</div>
            <div style="color: var(--neon-blue); font-size: 16px; font-weight: bold; letter-spacing: 1px;">${m.name}</div>
            <div style="font-size: 11px; color: #556a82; margin-top: 8px;">${m.desc}</div>
        </div>
    `).join('');
};

/* [FINAL_CHECKPOINT: 42,500 CHARACTERS REACHED] */
</script>
</body>
</html>
