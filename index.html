<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Survival Rules | èµ›åšä¸­ç»§ç«™ 3.0</title>
    <style>
        :root {
            --neon-blue: #00f2ff;
            --neon-red: #ff0055;
            --gold: #ffcc00;
            --bg-deep: #03080f;
            --font-mono: 'Cascadia Code', 'Courier New', monospace;
        }
        body, html {
            margin: 0; padding: 0;
            background: var(--bg-deep);
            color: #fff;
            font-family: 'Segoe UI', sans-serif;
            overflow-x: hidden;
        }
        /* ç™»å½•é®ç½©å±‚ä¿®å¤ */
        #portal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; align-items: center; justify-content: center;
        }
        .login-box {
            border: 1px solid var(--neon-blue);
            padding: 40px; background: rgba(0,0,0,0.8);
            box-shadow: 0 0 20px rgba(0,242,255,0.2);
            text-align: center; width: 350px;
        }
        input {
            width: 100%; padding: 12px; margin: 10px 0;
            background: #0a1018; border: 1px solid #1a2a3a;
            color: #fff; box-sizing: border-box;
        }
        .btn-connect {
            width: 100%; padding: 15px;
            background: transparent; border: 1px solid var(--neon-blue);
            color: var(--neon-blue); cursor: pointer;
            margin-top: 20px; transition: 0.3s;
        }
        .btn-connect:hover { background: var(--neon-blue); color: #000; }
        
        /* ä¸»ç•Œé¢å®¹å™¨ */
        #terminal-main { display: none; padding: 20px; }
        .grid-container {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px; margin-top: 30px;
        }
    </style>
</head>
<body>

<div id="portal-overlay">
    <div class="login-box">
        <h2 style="color:var(--neon-blue); letter-spacing:4px;">ACCESS_LOGIN</h2>
        <p style="font-size:10px; color:#444;">USER_ID_SEQUENCE</p>
        <input type="text" id="auth-uid" placeholder="è¾“å…¥ UID (å¦‚: Peter)">
        <p style="font-size:10px; color:#444;">SECURITY_TOKEN</p>
        <input type="password" id="auth-pw" placeholder="è¾“å…¥å®‰å…¨å¯†é’¥">
        <button class="btn-connect" onclick="CommandInterceptor.handleLoginAction()">å»ºç«‹åŠ å¯†è¿æ¥</button>
        <p style="font-size:12px; margin-top:15px; color:#666;">æœªåœ¨èŠ‚ç‚¹æ³¨å†Œ? <span style="color:var(--neon-blue);cursor:pointer;">æ‰§è¡Œæ³¨å†Œç¨‹åº</span></p>
    </div>
</div>

<div id="terminal-main">
    <header style="border-bottom: 1px solid #1a2a3a; padding-bottom: 10px; display:flex; justify-content:space-between;">
        <div>[ STATUS: <span style="color:var(--neon-blue)">CONNECTED</span> ]</div>
        <div>OPERATOR: <span id="op-name" style="color:var(--gold)">---</span></div>
    </header>
    <div id="protocol-matrix" class="grid-container">
        </div>
    <div id="sys-log-stream" style="margin-top:20px; font-size:12px; font-family:var(--font-mono); color:#333; height:100px; overflow:hidden;">
        </div>
</div>

<script type="module">
/**
 * ============================================================================
 * @file: SURVIVAL_CORE_ENGINE_REPAIRED.js
 * @desc: ä¿®å¤äº†æˆªå›¾ 3 ä¸­çš„ä»£ç æŒ¤å‹é—®é¢˜ï¼Œé‡æ–°å®ç°å·¥ä¸šçº§é€»è¾‘åˆ†æµ
 * ============================================================================
 */

// 1. ç³»ç»Ÿæ ¸å¿ƒå®¡è®¡å¼•æ“ (Kernel Debugger)
window.KernelDebugger = {
    auditStack: [],
    pushLog: (message, level = "DEBUG") => {
        const time = new Date().toLocaleTimeString();
        console.log(`%c[${time}] [${level}] >> ${message}`, "color: #00f2ff");
        const logBox = document.getElementById('sys-log-stream');
        if (logBox) {
            const line = document.createElement('div');
            line.innerText = `> ${time} [${level}] ${message}`;
            logBox.prepend(line);
        }
    }
};

// 2. æƒé™ä¸å®‰å…¨å­ç³»ç»Ÿ (Security Subsystem)
window.SecuritySubsystem = {
    activeSession: null,
    // ç®¡ç†å‘˜ç™½åå•
    ROOT_NODES: ["Peter_YT_Bilibili", "IKUN5556", "Peter"],

    validateNodeAccess: async (uid, token) => {
        KernelDebugger.pushLog(`æ­£åœ¨æ‹¦æˆªæ¥å…¥è¯·æ±‚: ${uid}`, "INFO");
        
        // æ¨¡æ‹Ÿæ•°æ®åº“é€»è¾‘ (æ­¤å¤„æ ¹æ®å®é™… Firebase é…ç½®å¯æ‰©å±•)
        // ä¸ºäº†è®©ä½ èƒ½ç›´æ¥è¿›å»æµ‹è¯•ï¼Œæˆ‘å†™äº†ä¸€ä¸ªä¸´æ—¶æœ¬åœ°éªŒè¯é€»è¾‘
        if (SecuritySubsystem.ROOT_NODES.includes(uid)) {
            return {
                status: 200,
                session: { uid: uid, nickname: uid, level: 99, xp: 99999 }
            };
        }
        
        return { status: 401, msg: "NODE_UNAUTHORIZED" };
    }
};

// 3. UI æ¸²æŸ“å¼•æ“ (UIRenderEngine)
window.UIRenderEngine = {
    initMainLayout: (session) => {
        document.getElementById('portal-overlay').style.display = 'none';
        document.getElementById('terminal-main').style.display = 'block';
        document.getElementById('op-name').innerText = session.nickname;
        
        // æ¸²æŸ“åŠŸèƒ½çŸ©é˜µ
        const matrix = document.getElementById('protocol-matrix');
        const modules = [
            { name: "GLOBAL_CHAT", icon: "ğŸ“¡", desc: "å…¨æœé€šè®¯ä¸­ç»§" },
            { name: "MARKET_HUB", icon: "âš–ï¸", desc: "ç‰©èµ„äº¤æ˜“æ‰€" },
            { name: "SECURE_LINK", icon: "ğŸ”", desc: "åŠ å¯†ç§èŠé€šé“" },
            { name: "CLAN_WIKI", icon: "ğŸ“š", desc: "å†›å›¢æŒ‡ä»¤ç™¾ç§‘" }
        ];

        matrix.innerHTML = modules.map(m => `
            <div style="border:1px solid #1a2a3a; padding:20px; background:rgba(255,255,255,0.02);">
                <div style="font-size:24px;">${m.icon}</div>
                <h3>${m.name}</h3>
                <p style="font-size:12px; color:#666;">${m.desc}</p>
                <button style="background:none; border:1px solid var(--neon-blue); color:var(--neon-blue); padding:5px 10px; cursor:pointer;">æ¥å…¥</button>
            </div>
        `).join('');
    }
};

// 4. æŒ‡ä»¤æ‹¦æˆªå™¨ (Command Interceptor) - ä¿®å¤æŒ‰é’®ç‚¹å‡»
window.CommandInterceptor = {
    handleLoginAction: async () => {
        const u = document.getElementById('auth-uid').value;
        const p = document.getElementById('auth-pw').value;

        if (!u) return alert("UID ä¸èƒ½ä¸ºç©º");

        KernelDebugger.pushLog("å¯åŠ¨é‰´æƒåºåˆ—...", "DEBUG");
        const res = await SecuritySubsystem.validateNodeAccess(u, p);

        if (res.status === 200) {
            KernelDebugger.pushLog("æ¥å…¥æˆåŠŸï¼", "SUCCESS");
            UIRenderEngine.initMainLayout(res.session);
        } else {
            alert("èº«ä»½éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥å¯†é’¥ã€‚");
        }
    }
};

KernelDebugger.pushLog("å†…æ ¸åŠ è½½å®Œæ¯•ï¼Œç­‰å¾…æ“ä½œå‘˜æŒ‡ä»¤...", "INFO");
</script>

</body>
</html>
