<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€ƒé‡Œå—ç§‘å¤« - å®˜æ–¹ç¤¾åŒº</title>
    <style>
        :root { --main-green: #2ecc71; --card-bg: #0b1118; --border: #1a222c; --text-gray: #8b949e; }
        body { background-color: #0d1117; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; overflow-x: hidden; }
        
        /* å¯¼èˆªæ  */
        nav { display: flex; justify-content: space-between; padding: 15px 30px; align-items: center; background: #0d1117; border-bottom: 1px solid var(--border); }
        .logo { color: var(--main-green); font-size: 22px; font-weight: bold; text-decoration: none; }
        .nav-right { display: flex; align-items: center; gap: 15px; }

        /* ç»Ÿä¸€æŒ‰é’® */
        .auth-btn { background: var(--main-green); color: black; border: none; padding: 8px 18px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-outline { background: transparent; color: white; border: 1px solid var(--border); padding: 8px 18px; border-radius: 5px; cursor: pointer; }

        /* é€šå‘Šæ¿ (æ›¿ä»£ Alert) */
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
        .toast { background: #161b22; border-left: 4px solid var(--main-green); color: white; padding: 15px 25px; margin-bottom: 10px; border-radius: 4px; box-shadow: 0 4px 12px rgba(0,0,0,0.5); font-size: 14px; }

        /* ç£è´´ç½‘æ ¼ */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; max-width: 1200px; margin: 40px auto; padding: 0 20px; }
        .card { background: #0d141d; padding: 25px; border-radius: 12px; border: 1px solid var(--border); cursor: pointer; transition: 0.3s; }
        .card:hover { border-color: var(--main-green); transform: translateY(-5px); background: #121d2b; }
        .card h3 { margin: 15px 0 5px 0; font-size: 18px; }
        .card p { color: var(--text-gray); font-size: 13px; margin: 0; }

        /* èŠå¤©å®¤é¢æ¿ */
        #chat-panel { display: none; position: fixed; bottom: 20px; right: 20px; width: 350px; height: 500px; background: #0d1117; border: 1px solid var(--main-green); border-radius: 10px; flex-direction: column; z-index: 1000; box-shadow: 0 0 20px rgba(0,0,0,0.8); }
        #chat-header { padding: 12px; background: #161b22; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        #chat-messages { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 10px; }
        .msg { background: #1c2632; padding: 8px 12px; border-radius: 8px; font-size: 14px; align-self: flex-start; max-width: 85%; }
        .msg b { color: var(--main-green); display: block; font-size: 11px; margin-bottom: 3px; }
        #chat-input-area { padding: 10px; display: flex; gap: 8px; border-top: 1px solid var(--border); }
        #chat-input-area input { flex: 1; background: #161b22; border: 1px solid var(--border); color: white; padding: 8px; border-radius: 5px; }

        /* ç™»å½•æ³¨å†Œå¼¹çª— */
        .modal-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index: 2000; }
        .modal { position: absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:#161b22; padding:30px; border-radius:12px; width:320px; border:1px solid var(--main-green); }
        .input-group { position: relative; margin: 15px 0; }
        .modal input { width:100%; padding:12px; background:#0d1117; border:1px solid var(--border); color:white; border-radius:6px; box-sizing:border-box; }
        .eye-btn { position: absolute; right: 12px; top: 12px; cursor: pointer; color: var(--text-gray); }
        .tab-btn { flex: 1; padding: 10px; text-align: center; cursor: pointer; color: var(--text-gray); border-bottom: 2px solid transparent; }
        .tab-btn.active { color: var(--main-green); border-bottom-color: var(--main-green); }
    </style>
</head>
<body>

<div id="toast-container"></div>

<nav>
    <a href="#" class="logo">é€ƒé‡Œå—ç§‘å¤«</a>
    <div class="nav-right" id="auth-ui">
        </div>
</nav>

<div style="text-align:center; padding: 60px 20px;">
    <h1 style="font-size: 48px; margin: 0;">é€ƒé‡Œå—ç§‘å¤«</h1>
    <p style="color: var(--text-gray); font-size: 18px;">æœé›†ç‰©èµ„ã€äº¤æ˜“è´§å“ã€æ¢ç´¢æœªçŸ¥åœ°å›¾</p>
</div>

<div class="grid">
    <div class="card" onclick="openChat()"><h3>ğŸ‘¥ ç»„é˜Ÿå¤§å…</h3><p>å®æ—¶åœ¨çº¿èŠå¤©ï¼Œå¯»æ‰¾é˜Ÿå‹</p></div>
    <div class="card" onclick="notify('ç©æ³•ä»‹ç»ï¼šå‰å¾€åœ°å›¾æœé›†ç‰©èµ„ï¼Œæ’¤ç¦»ç‚¹é€ƒç¦»ã€‚')"><h3>ğŸ® ç©æ³•ä»‹ç»</h3><p>äº†è§£æœåŠ¡å™¨è§„åˆ™ã€æŒ‡ä»¤åŠæŠ€å·§</p></div>
    <div class="card" onclick="notify('æ›´æ–°æ—¥å¿—ï¼šV1.2 ä¿®å¤äº†ç™»å½•æ˜¾ç¤ºé—®é¢˜ã€‚')"><h3>ğŸ”„ æ›´æ–°æ—¥å¿—</h3><p>æŸ¥çœ‹æœ€æ–°çš„ç‰ˆæœ¬å˜åŠ¨ä¸ä¿®å¤</p></div>
    <div class="card" onclick="notify('äººå‘˜åå•ï¼šPeter, Kevin, Mike...')"><h3>ğŸ‘¤ äººå‘˜åå•</h3><p>æŸ¥çœ‹å›¢å†…æˆå‘˜</p></div>
    <div class="card" onclick="notify('å…‘æ¢ç ç³»ç»Ÿï¼šæš‚æ— å¯ç”¨ä»£ç ã€‚')"><h3>ğŸ å…‘æ¢ç </h3><p>è¾“å…¥ç¤¼åŒ…ç è·å–é™æ—¶å¥–åŠ±</p></div>
    <div class="card" onclick="notify('äº¤æ˜“è¡Œï¼šå°†åœ¨ä¸‹ä¸ªç‰ˆæœ¬ä¸Šçº¿ã€‚')"><h3>ğŸª äº¤æ˜“è¡Œ</h3><p>è´­ä¹°å’Œå‡ºå”®ç‰©å“</p></div>
</div>

<div id="chat-panel">
    <div id="chat-header">
        <span style="font-weight:bold">ç»„é˜Ÿå¤§å…</span>
        <span onclick="closeChat()" style="cursor:pointer">âœ•</span>
    </div>
    <div id="chat-messages"></div>
    <div id="chat-input-area">
        <input type="text" id="msg-input" placeholder="è¾“å…¥æ¶ˆæ¯..." onkeypress="if(event.keyCode==13) sendMsg()">
        <button class="auth-btn" onclick="sendMsg()">å‘é€</button>
    </div>
</div>

<div class="modal-overlay" id="modal-overlay">
    <div class="modal">
        <div style="display:flex; margin-bottom:20px;">
            <div id="tab-login" class="tab-btn active" onclick="switchTab('login')">ç™»å½•</div>
            <div id="tab-reg" class="tab-btn" onclick="switchTab('reg')">æ³¨å†Œ</div>
        </div>
        <div class="input-group" id="nick-box" style="display:none">
            <input type="text" id="auth-nick" placeholder="æ¸¸æˆæ˜µç§°">
        </div>
        <div class="input-group">
            <input type="text" id="auth-id" placeholder="è´¦å· ID">
        </div>
        <div class="input-group">
            <input type="password" id="auth-pw" placeholder="å¯†ç ">
            <span class="eye-btn" onclick="togglePw()">ğŸ‘ï¸</span>
        </div>
        <button class="auth-btn" style="width:100%" id="auth-submit" onclick="doAuth()">ç¡®å®š</button>
        <button class="btn-outline" style="width:100%; margin-top:10px" onclick="closeModal()">å–æ¶ˆ</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, limit, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBC92jwiCLsfG6bE4k2Jo4KQSiI-A_gxII",
        authDomain: "bloxd-survival.firebaseapp.com",
        projectId: "bloxd-survival",
        storageBucket: "bloxd-survival.firebasestorage.app",
        messagingSenderId: "60666065786",
        appId: "1:60666065786:web:bdc3131accaceb0180dcc3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let currentUser = JSON.parse(localStorage.getItem('user'));
    let authMode = 'login';

    // æ ¸å¿ƒåŠŸèƒ½ï¼šæ‰“å¼€èŠå¤©å®¤
    window.openChat = () => {
        if(!currentUser) return notify("âŒ è¯·å…ˆç™»å½•è´¦å·å†ä½¿ç”¨èŠå¤©åŠŸèƒ½");
        document.getElementById('chat-panel').style.display = 'flex';
        initChat();
    };
    window.closeChat = () => document.getElementById('chat-panel').style.display = 'none';

    // èŠå¤©é€»è¾‘
    function initChat() {
        const q = query(collection(db, "messages"), orderBy("createdAt", "asc"), limit(50));
        onSnapshot(q, (snapshot) => {
            const container = document.getElementById('chat-messages');
            container.innerHTML = '';
            snapshot.forEach(doc => {
                const d = doc.data();
                const div = document.createElement('div');
                div.className = 'msg';
                div.innerHTML = `<b>${d.user}</b>${d.text}`;
                container.appendChild(div);
            });
            container.scrollTop = container.scrollHeight;
        });
    }

    window.sendMsg = async () => {
        const input = document.getElementById('msg-input');
        if(!input.value.trim()) return;
        try {
            await addDoc(collection(db, "messages"), {
                text: input.value,
                user: currentUser.nick,
                createdAt: serverTimestamp()
            });
            input.value = '';
        } catch(e) { notify("å‘é€å¤±è´¥ï¼Œè¯·ç¡®ä¿æ•°æ®åº“å·²è®¾ä¸ºæµ‹è¯•æ¨¡å¼"); }
    };

    // è®¤è¯é€»è¾‘
    window.doAuth = () => {
        const id = document.getElementById('auth-id').value;
        const pw = document.getElementById('auth-pw').value;
        const nick = document.getElementById('auth-nick').value;

        if(authMode === 'reg') {
            if(!id || !pw || !nick) return notify("è¯·å¡«å†™å®Œæ•´ä¿¡æ¯");
            const user = { id, pw, nick };
            localStorage.setItem('db_user_'+id, JSON.stringify(user));
            login(user);
        } else {
            const saved = localStorage.getItem('db_user_'+id);
            if(!saved) return notify("è´¦å·ä¸å­˜åœ¨");
            const user = JSON.parse(saved);
            if(user.pw !== pw) return notify("å¯†ç é”™è¯¯");
            login(user);
        }
    };

    function login(user) {
        localStorage.setItem('user', JSON.stringify(user));
        currentUser = user;
        closeModal();
        updateUI();
        notify("âœ… æ¬¢è¿ï¼Œ" + user.nick);
    }

    // UI æ§åˆ¶
    window.switchTab = (m) => {
        authMode = m;
        document.getElementById('tab-login').className = m==='login'?'tab-btn active':'tab-btn';
        document.getElementById('tab-reg').className = m==='reg'?'tab-btn active':'tab-btn';
        document.getElementById('nick-box').style.display = m==='reg'?'block':'none';
    };
    window.togglePw = () => {
        const p = document.getElementById('auth-pw');
        p.type = p.type === 'password' ? 'text' : 'password';
    };
    window.notify = (t) => {
        const c = document.getElementById('toast-container');
        const d = document.createElement('div');
        d.className = 'toast'; d.innerText = t;
        c.appendChild(d); setTimeout(()=>d.remove(), 3000);
    };
    window.showModal = () => document.getElementById('modal-overlay').style.display = 'block';
    window.closeModal = () => document.getElementById('modal-overlay').style.display = 'none';
    window.logout = () => { localStorage.removeItem('user'); location.reload(); };

    window.updateUI = () => {
        const ui = document.getElementById('auth-ui');
        if(currentUser) {
            ui.innerHTML = `<span>æ¬¢è¿, ${currentUser.nick}</span><button class="btn-outline" onclick="logout()">é€€å‡º</button>`;
        } else {
            ui.innerHTML = `<button class="auth-btn" onclick="showModal()">ç™»å½• / æ³¨å†Œ</button>`;
        }
    };
    updateUI();
</script>
</body>
</html>
