<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生存法则 - 官方社区</title>
    <style>
        :root { --main-green: #2ecc71; --card-bg: #161b22; --text-gray: #8b949e; }
        body { background-color: #0d1117; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; text-align: center; }
        nav { display: flex; justify-content: space-between; padding: 15px 50px; align-items: center; background: #161b22; border-bottom: 1px solid #30363d; }
        .logo { color: var(--main-green); font-size: 24px; font-weight: bold; text-decoration: none; }
        .auth-btn { background: var(--main-green); color: black; border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .hero { padding: 60px 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; max-width: 1000px; margin: 20px auto; padding: 0 20px; }
        .card { background: var(--card-bg); padding: 30px; border-radius: 10px; border: 1px solid #30363d; cursor: pointer; transition: 0.3s; }
        .card:hover { border-color: var(--main-green); transform: translateY(-5px); }
        
        /* 登录弹窗样式 */
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #21262d; padding: 30px; border-radius: 10px; border: 1px solid var(--main-green); z-index: 1000; width: 300px; }
        .modal input { width: 90%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #30363d; background: #0d1117; color: white; }
        .modal-btns { display: flex; justify-content: space-around; margin-top: 15px; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 999; }
    </style>
</head>
<body>

<nav>
    <a href="#" class="logo">生存法则</a>
    <div id="auth-ui"><button class="auth-btn" onclick="showModal()">登录 / 注册</button></div>
</nav>

<div class="hero">
    <h1 id="welcome-msg">生存法则 · 官方社区</h1>
    <p style="color:var(--text-gray)">搜集物资、交易货品、探索未知地图</p>
</div>

<div class="grid">
    <div class="card" onclick="checkAuth('组队大厅')"><h3>组队大厅</h3><p>寻找队友并肩作战</p></div>
    <div class="card" onclick="checkAuth('交易行')"><h3>交易行</h3><p>安全的物资买卖中心</p></div>
    <div class="card" onclick="checkAuth('兑换码')"><h3>兑换码</h3><p>领取限时物资奖励</p></div>
</div>

<div class="overlay" id="overlay" onclick="hideModal()"></div>
<div class="modal" id="auth-modal">
    <h3 id="modal-title">账号登录</h3>
    <input type="email" id="email" placeholder="输入邮箱 (作为账号)">
    <input type="password" id="password" placeholder="输入密码">
    <div class="modal-btns">
        <button class="auth-btn" onclick="handleAuth('login')">登录</button>
        <button class="auth-btn" style="background:transparent; color:white; border:1px solid white;" onclick="handleAuth('register')">注册</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBC92jwiCLsfG6bE4k2Jo4KQSiI-A_gxII",
        authDomain: "bloxd-survival.firebaseapp.com",
        projectId: "bloxd-survival",
        storageBucket: "bloxd-survival.firebasestorage.app",
        messagingSenderId: "60666065786",
        appId: "1:60666065786:web:bdc3131accaceb0180dcc3",
        measurementId: "G-L39F7GPMF4"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    let currentUser = null;

    // 弹窗控制
    window.showModal = () => { document.getElementById('auth-modal').style.display = 'block'; document.getElementById('overlay').style.display = 'block'; };
    window.hideModal = () => { document.getElementById('auth-modal').style.display = 'none'; document.getElementById('overlay').style.display = 'none'; };

    // 登录与注册逻辑
    window.handleAuth = (type) => {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        if (!email || !password) return alert("请填写账号和密码");

        if (type === 'register') {
            createUserWithEmailAndPassword(auth, email, password)
                .then(() => { alert("注册成功并已登录！"); hideModal(); })
                .catch(err => alert("注册失败: " + err.message));
        } else {
            signInWithEmailAndPassword(auth, email, password)
                .then(() => { alert("登录成功！"); hideModal(); })
                .catch(err => alert("登录失败: " + err.message));
        }
    };

    window.logout = () => signOut(auth);

    window.checkAuth = (name) => {
        if (!currentUser) alert("请先登录！");
        else alert("欢迎来到 " + name);
    };

    onAuthStateChanged(auth, (user) => {
        const ui = document.getElementById('auth-ui');
        const welcome = document.getElementById('welcome-msg');
        currentUser = user;
        if (user) {
            welcome.innerText = "欢迎回来, 生存者";
            ui.innerHTML = `<button class="auth-btn" onclick="logout()">退出登录</button>`;
        } else {
            welcome.innerText = "生存法则 · 官方社区";
            ui.innerHTML = `<button class="auth-btn" onclick="showModal()">登录 / 注册</button>`;
        }
    });
</script>
</body>
</html>
