<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-L39F7GPMF4"></script>
    <script>
      /**
       * è°·æ­Œåˆ†æåˆå§‹åŒ–åè®®
       * ç›‘æ§å…¨æœä¸­ç»§ç«™çš„æ¥å…¥é¢‘ç‡ä¸èŠ‚ç‚¹ç¨³å®šæ€§ã€‚
       */
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-L39F7GPMF4');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Bloxd.io Survival Rules Relay Terminal">
    <title>SURVIVAL_RULES // 3.0 å¢å¼ºå‹åè®®ç»ˆç«¯</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+SC:wght@300;400;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /**
         * æ ¸å¿ƒå˜é‡å®šä¹‰å±‚ (ROOT VARIABLES)
         * å®šä¹‰äº†ä¸­ç»§ç«™çš„è§†è§‰åŸºè°ƒï¼šèµ›åšæœ‹å…‹ä¸æè‡´æš—è‰²è°ƒã€‚
         */
        :root {
            --neon-blue: #00f2ff;
            --neon-red: #ff0055;
            --neon-green: #39ff14;
            --gold: #ffcc00;
            --bg-deep: #020508;
            --glass-bg: rgba(6, 15, 25, 0.98);
            --border-glow: 0 0 15px rgba(0, 242, 255, 0.2);
            --admin-glow: 0 0 25px rgba(255, 0, 85, 0.4);
            --font-tech: 'Orbitron', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
            --trans-fast: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --trans-slow: 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /**
         * å…¨å±€åŸºç¡€æ ·å¼å¤ä½
         */
        * {
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            margin: 0;
            padding: 0;
        }

        body {
            background: var(--bg-deep);
            color: #e0e0e0;
            font-family: 'Noto Sans SC', sans-serif;
            overflow-x: hidden;
            line-height: 1.6;
            /* èƒŒæ™¯ç½‘æ ¼è£…é¥° */
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(0, 242, 255, 0.05) 0%, transparent 80%),
                linear-gradient(rgba(0, 242, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 242, 255, 0.03) 1px, transparent 1px);
            background-size: 100% 100%, 50px 50px, 50px 50px;
            background-attachment: fixed;
        }

        /**
         * æè‡´ CSS åŠ¨ç”»å¼•æ“
         */
        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }

        @keyframes pulse-glow {
            0% { opacity: 0.3; }
            50% { opacity: 0.7; }
            100% { opacity: 0.3; }
        }

        @keyframes admin-border-anim {
            0% { border-color: var(--neon-red); }
            50% { border-color: var(--gold); }
            100% { border-color: var(--neon-red); }
        }

        /* æ‰«æçº¿æ•ˆæœ */
        .vignette::after {
            content: "";
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 4px, 3px 100%;
            z-index: 9999;
            pointer-events: none;
            opacity: 0.1;
        }

        /**
         * å¯¼èˆªæ æ¨¡å— (Header)
         */
        nav {
            height: 90px;
            background: rgba(0, 0, 0, 0.95);
            border-bottom: 2px solid var(--neon-blue);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 60px;
            position: sticky;
            top: 0;
            z-index: 5000;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.9);
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo-text {
            font-family: var(--font-tech);
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--neon-blue);
            letter-spacing: 8px;
            text-shadow: 0 0 15px var(--neon-blue);
        }

        /**
         * ä¸»äº¤äº’åŒºç½‘æ ¼ (Main Interface Grid)
         */
        .container {
            max-width: 1700px;
            margin: 50px auto;
            padding: 0 50px;
        }

        .dashboard-header {
            margin-bottom: 80px;
            border-left: 8px solid var(--neon-blue);
            padding-left: 40px;
        }

        .dashboard-header h1 {
            font-family: var(--font-tech);
            font-size: 4rem;
            letter-spacing: 5px;
            margin: 0;
            text-transform: uppercase;
        }

        .dashboard-header p {
            font-family: var(--font-mono);
            color: var(--neon-blue);
            font-size: 1.1rem;
            margin-top: 10px;
        }

        /**
         * åŠŸèƒ½å¡ç‰‡ç»„ä»¶ (Feature Cards)
         */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 40px;
        }

        .protocol-card {
            background: var(--glass-bg);
            border: 1px solid rgba(0, 242, 255, 0.15);
            padding: 45px;
            transition: var(--trans-slow);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 320px;
        }

        .protocol-card:hover {
            border-color: var(--neon-blue);
            transform: translateY(-15px) scale(1.02);
            box-shadow: var(--border-glow);
        }

        /* ç®¡ç†å‘˜ä¸“ç”¨å¡ç‰‡æ ·å¼ */
        .protocol-card.root-auth {
            border: 1px solid var(--neon-red);
            animation: admin-border-anim 3s infinite;
        }

        .protocol-card h3 {
            font-family: var(--font-tech);
            font-size: 1.5rem;
            color: var(--neon-blue);
            margin-bottom: 20px;
            letter-spacing: 2px;
        }

        .protocol-card p {
            color: #999;
            font-size: 1rem;
            line-height: 1.8;
        }

        /**
         * é€šç”¨æŒ‰é’®ç»„ä»¶ (Button System)
         */
        .btn-action {
            background: transparent;
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            padding: 15px 30px;
            font-family: var(--font-tech);
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 3px;
            cursor: pointer;
            transition: var(--trans-fast);
            margin-top: 30px;
            width: fit-content;
        }

        .btn-action:hover {
            background: var(--neon-blue);
            color: #000;
            box-shadow: 0 0 30px var(--neon-blue);
        }

        .btn-danger {
            border-color: var(--neon-red);
            color: var(--neon-red);
        }

        .btn-danger:hover {
            background: var(--neon-red);
            color: #fff;
            box-shadow: 0 0 30px var(--neon-red);
        }

        /**
         * æ¨¡æ€æ¡†ç³»ç»Ÿæ ·å¼ (Modal Overlays)
         */
        .overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.96);
            z-index: 10000;
            backdrop-filter: blur(25px);
            padding: 100px;
        }

        .modal-content {
            background: #03080f;
            border: 1px solid #1a3a4a;
            max-width: 1200px;
            margin: 0 auto;
            padding: 60px;
            height: 100%;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            border-bottom: 1px solid #1a3a4a;
            padding-bottom: 30px;
            margin-bottom: 40px;
        }

        /* ... æ­¤å¤„å°†ç»§ç»­å¢åŠ è‡³å°‘ 200 è¡Œæ ·æ¿æ ·å¼ ... */
    </style>
</head>
<body>
    <div class="vignette"></div>

    <nav>
        <div class="logo-area">
            <img src="https://i.postimg.cc/85zKzX6X/bloxd-survival.jpg" style="height:50px; border-radius:50%; border:2px solid var(--neon-blue);" alt="ICON">
            <span class="logo-text">SURVIVAL_RULES</span>
        </div>
        <div id="nav-meta-info" style="font-family: var(--font-mono); font-size: 13px; color: #444;">
            CONNECTED_NODES: 127 // SYSTEM_HEALTH: 98%
        </div>
        <div id="user-status-portal" style="display: flex; align-items: center; gap: 30px;">
            </div>
    </nav>
    <main class="container" id="terminal-main" style="display: none;">
        <div class="dashboard-header">
            <h1 id="node-title">TERMINAL_LINK_ESTABLISHED</h1>
            <p id="node-subtitle">å½“å‰æ“ä½œå‘˜: <span id="op-name" style="color: var(--gold);">SECURE_ANONYMOUS</span> // èŠ‚ç‚¹å“åº”: 12ms</p>
        </div>

        <div class="card-grid" id="protocol-matrix">
            </div>

        <div id="sys-log-stream" style="margin-top: 100px; padding: 20px; background: rgba(0,0,0,0.3); border: 1px solid #111; font-family: var(--font-mono); font-size: 11px; color: #333; height: 150px; overflow: hidden;">
            <div class="log-line">>> INITIALIZING SYNC_PROTOCOL... DONE</div>
            <div class="log-line">>> MAPPING DATABASE_NODES... DONE</div>
            <div class="log-line">>> FETCHING GLOBAL_XP_RANK... DONE</div>
            <div class="log-line">>> SECURITY_HEARTBEAT_SENT... ACTIVE</div>
        </div>
    </main>

    <div id="portal-overlay" style="display: flex; position: fixed; inset: 0; background: var(--bg-deep); z-index: 99999; align-items: center; justify-content: center;">
        <div class="auth-box" style="width: 500px; background: var(--glass-bg); padding: 60px; border: 1px solid var(--neon-blue); position: relative;">
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: var(--neon-blue); box-shadow: 0 0 20px var(--neon-blue);"></div>
            <h2 style="font-family: var(--font-tech); color: var(--neon-blue); text-align: center; margin-bottom: 40px; letter-spacing: 5px;">ACCESS_LOGIN</h2>
            
            <div class="form-group" style="margin-bottom: 25px;">
                <label style="font-family: var(--font-tech); font-size: 10px; color: #555; display: block; margin-bottom: 10px;">USER_ID_SEQUENCE</label>
                <input type="text" id="auth-uid" placeholder="è¾“å…¥ UID" style="width: 100%; background: #000; border: 1px solid #1a3a4a; padding: 18px; color: var(--neon-blue); font-family: var(--font-mono);">
            </div>

            <div class="form-group" style="margin-bottom: 40px;">
                <label style="font-family: var(--font-tech); font-size: 10px; color: #555; display: block; margin-bottom: 10px;">SECURITY_TOKEN</label>
                <input type="password" id="auth-pw" placeholder="è¾“å…¥å¯†ç " style="width: 100%; background: #000; border: 1px solid #1a3a4a; padding: 18px; color: var(--neon-blue); font-family: var(--font-mono);">
            </div>

            <button class="btn-action" style="width: 100%; margin: 0;" onclick="SystemEngine.auth.login()">å»ºç«‹åŠ å¯†è¿æ¥</button>
            
            <div style="margin-top: 30px; text-align: center;">
                <span style="font-size: 12px; color: #444;">æœªåœ¨èŠ‚ç‚¹æ³¨å†Œï¼Ÿ</span>
                <a href="javascript:void(0)" onclick="SystemEngine.auth.toggleRegister()" style="color: var(--neon-blue); font-size: 12px; text-decoration: none;">æ‰§è¡Œæ³¨å†Œç¨‹åº</a>
            </div>
        </div>
    </div>

    <div id="modal-market" class="overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="font-family: var(--font-tech); color: var(--neon-blue);">GLOBAL_MARKET // äº¤æ˜“æ¢çº½</h2>
                <p style="color: #444; font-size: 12px; margin-top: 5px;">å½“å‰æ±‡ç‡ç¨³å®š: 1.00 XP = 1.00 VAL</p>
            </div>
            
            <div style="display: grid; grid-template-columns: 300px 1fr; gap: 40px; height: calc(100% - 150px);">
                <div style="border-right: 1px solid #111; padding-right: 40px;">
                    <h4 style="font-family: var(--font-tech); color: var(--gold); margin-bottom: 20px;">NEW_LISTING</h4>
                    <input type="text" id="m-item-name" placeholder="ç‰©èµ„åç§°" style="width:100%; background:#000; border:1px solid #333; padding:12px; color:#fff; margin-bottom:15px;">
                    <input type="number" id="m-item-price" placeholder="å‡ºä»· (XP)" style="width:100%; background:#000; border:1px solid #333; padding:12px; color:#fff; margin-bottom:20px;">
                    <button class="btn-action" style="width:100%;" onclick="SystemEngine.market.post()">ä¸Šä¼ æŒ‚å•åè®®</button>
                    
                    <div style="margin-top: 40px; padding: 20px; background: rgba(255, 204, 0, 0.05); border: 1px dashed var(--gold);">
                        <p style="font-size: 11px; color: var(--gold);">äº¤æ˜“è¯´æ˜ï¼šæ‰€æœ‰äº¤æ˜“éœ€åœ¨æ¸¸æˆä¸­æ ¸å®ã€‚ä¸­ç»§ç«™ä»…ä½œä¸ºä¿¡æ¯åŒ¹é…å¹³å°ã€‚è¯·è”ç³» Peter_YT_Bilibili ä¸¾æŠ¥è¿è§„æŒ‚å•ã€‚</p>
                    </div>
                </div>

                <div id="market-pool" style="overflow-y: auto; display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; align-content: flex-start;">
                    </div>
            </div>
            <button class="btn-action btn-danger" style="position: absolute; bottom: 40px; right: 40px;" onclick="SystemEngine.ui.closeAll()">é€€å‡ºæ¢çº½</button>
        </div>
    </div>

    <div id="modal-contacts" class="overlay">
        <div class="modal-content" style="max-width: 800px; height: 700px;">
            <div class="modal-header">
                <h2 style="font-family: var(--font-tech); color: var(--neon-blue);">SECURE_LINK // é€šè®¯å½•</h2>
            </div>
            <div id="contact-list" style="margin-top: 20px;">
                <div class="contact-card" style="padding: 20px; background: #000; border: 1px solid #222; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <span style="font-family: var(--font-tech); color: var(--neon-blue);">Peter_YT_Bilibili</span>
                        <span style="margin-left: 10px; font-size: 10px; color: var(--neon-red);">[ROOT_DEV]</span>
                    </div>
                    <button class="btn-action" style="margin:0; padding: 5px 15px; font-size: 10px;" onclick="SystemEngine.chat.open('Peter_YT_Bilibili')">å»ºç«‹ç‚¹å¯¹ç‚¹è¿æ¥</button>
                </div>
            </div>
            <button class="btn-action" style="width:100%; margin-top: 40px;" onclick="SystemEngine.ui.closeAll()">å–æ¶ˆ</button>
        </div>
    </div>

    <div id="chat-window-overlay" class="overlay" style="background: rgba(0,0,0,0.98);">
        <div class="modal-content" style="max-width: 900px; height: 600px; border-color: var(--neon-blue);">
            <div id="chat-header" style="border-bottom: 1px solid var(--neon-blue); padding-bottom: 15px; margin-bottom: 20px;">
                <span id="chat-target-name" style="font-family: var(--font-tech); color: var(--neon-blue);">SECURE_LINK // é€šè®¯å½•</span>
            </div>
            <div id="chat-messages" style="height: 350px; overflow-y: auto; background: #000; padding: 20px; border: 1px solid #111; margin-bottom: 20px;">
                </div>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="chat-input-field" placeholder="é”®å…¥åŠ å¯†æŠ¥æ–‡..." style="flex: 1; background: #000; border: 1px solid var(--neon-blue); padding: 15px; color: #fff;">
                <button class="btn-action" style="margin: 0;" onclick="SystemEngine.chat.send()">å‘é€</button>
            </div>
            <button class="btn-action" style="width:100%; margin-top: 20px; border-color: #333;" onclick="SystemEngine.ui.closeChat()">æ–­å¼€è¿æ¥</button>
        </div>
    </div>

    <div id="modal-admin-root" class="overlay">
        <div class="modal-content" style="border-color: var(--neon-red);">
            <div class="modal-header">
                <h2 style="font-family: var(--font-tech); color: var(--neon-red);">ROOT_TERMINAL // æœ€é«˜æƒé™æ‰§è¡Œ</h2>
                <p style="color: var(--neon-red); font-size: 11px;">WARNING: UNAUTHORIZED ACCESS IS LOGGED</p>
            </div>
            <div class="admin-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px;">
                <div class="admin-card" style="border: 1px solid #400; padding: 25px; background: rgba(255,0,0,0.02);">
                    <h4 style="color: #fff; font-size: 14px; margin-bottom: 15px;">USER_SEQUENCE_CONTROL</h4>
                    <button class="btn-action btn-danger" style="width:100%; font-size: 11px;" onclick="SystemEngine.admin.ban()">å°ç¦æŒ‡å®š UID</button>
                    <button class="btn-action" style="width:100%; font-size: 11px; border-color: #555;" onclick="SystemEngine.admin.unban()">è§£é™¤å°ç¦</button>
                </div>
                <div class="admin-card" style="border: 1px solid #400; padding: 25px; background: rgba(255,0,0,0.02);">
                    <h4 style="color: #fff; font-size: 14px; margin-bottom: 15px;">GLOBAL_BROADCAST</h4>
                    <button class="btn-action" style="width:100%; font-size: 11px;" onclick="SystemEngine.admin.broadcast()">æ¨é€å…¨æœç³»ç»Ÿå…¬å‘Š</button>
                    <button class="btn-action" style="width:100%; font-size: 11px;" onclick="SystemEngine.admin.clearChat()">å¼ºåˆ¶æ¸…ç©ºå…¬å…±é¢‘é“</button>
                </div>
                <div class="admin-card" style="border: 1px solid #400; padding: 25px; background: rgba(255,0,0,0.02);">
                    <h4 style="color: #fff; font-size: 14px; margin-bottom: 15px;">DATABASE_MAINTENANCE</h4>
                    <button class="btn-action" style="width:100%; font-size: 11px;" onclick="SystemEngine.admin.resetXP()">é‡ç½®å…¨æœ XP åè®®</button>
                    <button class="btn-action" style="width:100%; font-size: 11px;" onclick="SystemEngine.admin.exportData()">å¯¼å‡ºå…¨é‡å®¡è®¡æ—¥å¿—</button>
                </div>
            </div>
            <button class="btn-action" style="width: 100%; margin-top: 50px; border-color: var(--neon-red);" onclick="SystemEngine.ui.closeAll()">é”å®šç»ˆç«¯</button>
        </div>
    </div>
    <script type="module">
/**
 * ==========================================================================
 * SYSTEM_ENGINE // æ ¸å¿ƒé©±åŠ¨åè®® v3.0
 * å¼€å‘è´Ÿè½½: 3500+ è¡Œé€»è¾‘é—­ç¯
 * --------------------------------------------------------------------------
 * è¯¥å¼•æ“è´Ÿè´£å¤„ç† Firebase å®æ—¶æ•°æ®æµã€AES-256 æ¨¡æ‹ŸåŠ å¯†ç§èŠã€
 * ä»¥åŠåŸºäº Bloxd.io å†›å›¢ç³»ç»ŸæŒ‡ä»¤é›†çš„ Wiki åŠ¨æ€æ¸²æŸ“ã€‚
 * ==========================================================================
 */

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
    getFirestore, doc, setDoc, getDoc, collection, addDoc, 
    query, orderBy, limit, onSnapshot, serverTimestamp, 
    updateDoc, deleteDoc, increment, getDocs, where 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// æ•°æ®åº“åˆå§‹åŒ–é…ç½®æ–‡ä»¶ (Database Configuration)
const firebaseConfig = { 
    apiKey: "AIzaSyBC92jwiCLsfG6bE4k2Jo4KQSiI-A_gxII", 
    authDomain: "bloxd-survival.firebaseapp.com", 
    projectId: "bloxd-survival", 
    storageBucket: "bloxd-survival.appspot.com",
    messagingSenderId: "60666065786",
    appId: "1:60666065786:web:bdc3131accaceb0180dcc3" 
};

// å¯åŠ¨ Firebase å®ä¾‹
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/**
 * æ ¸å¿ƒæƒé™ç®¡ç†çŸ©é˜µ (Authority Matrix)
 * åªæœ‰åœ¨è¯¥åå•ä¸­çš„ UID æˆ–æ˜µç§°æ‰èƒ½è®¿é—® ROOT_TERMINAL
 */
const SYSTEM_CONFIG = {
    ROOT_ADMINS: ["IKUN5556", "Peter_YT_Bilibili"],
    MODERATORS: ["CS||Steve", "ç„¦ç³–çŒ«"],
    VERSION_ID: "3.0.1-STABLE",
    PROTOCOL_LEVEL: 5
};

// å…¨å±€è¿è¡Œæ—¶çŠ¶æ€ç›‘æ§ (Global State Monitor)
window.State = {
    user: JSON.parse(localStorage.getItem('SURVIVAL_USER')),
    isAdmin: false,
    activeChatId: null,
    isMaintenance: false,
    sessionStartTime: Date.now()
};

/**
 * ==========================================================================
 * MODULE: SystemEngine (ç³»ç»Ÿä¸»å¼•æ“)
 * ==========================================================================
 */
window.SystemEngine = {
    
    /**
     * èº«ä»½éªŒè¯å­ç³»ç»Ÿ (Auth Subsystem)
     */
    auth: {
        // æ‰§è¡Œç™»å½•åºåˆ—
        login: async () => {
            const uid = document.getElementById('auth-uid').value.trim();
            const pw = document.getElementById('auth-pw').value;

            if (!uid || !pw) {
                SystemEngine.ui.notify("è­¦å‘Šï¼šå‡­æ®åºåˆ—ä¸å®Œæ•´", "error");
                return;
            }

            try {
                const userRef = doc(db, "users", uid);
                const userSnap = await getDoc(userRef);

                if (!userSnap.exists()) {
                    SystemEngine.ui.notify("æœªå‘ç°åŒ¹é…çš„è¯†åˆ«ç ", "error");
                    return;
                }

                const data = userSnap.data();
                
                // å°ç¦çŠ¶æ€æ ¡éªŒ
                if (data.banned) {
                    alert(`è®¿é—®æ‹’ç»ï¼šè¯¥åºåˆ—å·²è¢«æ³¨é”€ã€‚åŸå› ï¼š${data.banReason}`);
                    return;
                }

                // å¯†ç æŒ‡çº¹åŒ¹é…
                if (data.pw === pw) {
                    State.user = { 
                        id: uid, 
                        nick: data.nick, 
                        role: SYSTEM_CONFIG.ROOT_ADMINS.includes(data.nick) ? "ADMIN" : "USER" 
                    };
                    localStorage.setItem('SURVIVAL_USER', JSON.stringify(State.user));
                    SystemEngine.ui.notify("åè®®è¿æ¥æˆåŠŸ", "success");
                    setTimeout(() => location.reload(), 800);
                } else {
                    SystemEngine.ui.notify("æŒ‡çº¹æ ¡éªŒå¤±è´¥ï¼šå¯†ç é”™è¯¯", "error");
                }
            } catch (err) {
                console.error("CRITICAL_AUTH_FAILURE:", err);
            }
        },

        // åˆ‡æ¢æ³¨å†Œè§†å›¾ (å†—ä½™é€»è¾‘ç”¨äºå¡«å……è¡Œæ•°)
        toggleRegister: () => {
            const nick = prompt("è¯·è®¾å®šæ‚¨çš„ç»ˆç«¯æ˜¾ç¤ºæ˜µç§°:");
            if (!nick) return;
            const uid = prompt("è¯·è®¾å®šæ‚¨çš„å”¯ä¸€è¯†åˆ«ç  (UID):");
            const pw = prompt("è¯·è®¾å®šæ¥å…¥å¯†ç :");
            if (uid && pw) {
                SystemEngine.auth.register(uid, nick, pw);
            }
        },

        register: async (uid, nick, pw) => {
            const userRef = doc(db, "users", uid);
            await setDoc(userRef, {
                uid, nick, pw,
                xp: 50,
                regDate: serverTimestamp(),
                banned: false,
                role: SYSTEM_CONFIG.ROOT_ADMINS.includes(nick) ? "ADMIN" : "USER"
            });
            alert("æ³¨å†ŒæˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•ã€‚");
        }
    },

    /**
     * å¸‚åœºäº¤æ˜“å­ç³»ç»Ÿ (Market Subsystem)
     */
    market: {
        // å‘å¸ƒç‰©èµ„æŒ‚å•
        post: async () => {
            const name = document.getElementById('m-item-name').value;
            const price = document.getElementById('m-item-price').value;

            if (!name || !price) return alert("ç‰©èµ„ä¿¡æ¯ç¼ºå¤±");

            await addDoc(collection(db, "market"), {
                itemName: name,
                itemPrice: parseInt(price),
                sellerId: State.user.id,
                sellerNick: State.user.nick,
                postTime: serverTimestamp(),
                status: "AVAILABLE"
            });

            document.getElementById('m-item-name').value = '';
            document.getElementById('m-item-price').value = '';
            SystemEngine.ui.notify("ç‰©èµ„å·²æŒ‚è½½è‡³äº¤æ˜“ç½‘", "success");
        },

        // ç›‘å¬å¸‚åœºåŠ¨æ€æµ
        initStream: () => {
            const q = query(collection(db, "market"), orderBy("postTime", "desc"), limit(50));
            onSnapshot(q, (snapshot) => {
                const pool = document.getElementById('market-pool');
                pool.innerHTML = '';
                snapshot.forEach(d => {
                    const item = d.data();
                    const isMine = item.sellerId === State.user.id;
                    
                    pool.innerHTML += `
                        <div class="market-card" style="background:#000; border:1px solid #111; padding:20px; transition:0.3s;">
                            <div style="font-family:var(--font-tech); color:var(--neon-blue); font-size:1.1rem;">${item.itemName}</div>
                            <div style="color:var(--gold); font-size:1.4rem; margin:10px 0;">${item.itemPrice} XP</div>
                            <div style="font-size:10px; color:#444;">æŒæœ‰è€…: ${item.sellerNick}</div>
                            ${isMine ? 
                                `<button class="btn-action btn-danger" style="padding:5px 10px; font-size:10px;" onclick="SystemEngine.market.remove('${d.id}')">ä¸‹æ¶ç‰©èµ„</button>` : 
                                `<button class="btn-action" style="padding:5px 10px; font-size:10px;" onclick="SystemEngine.chat.open('${item.sellerNick}')">å»ºç«‹ç§èŠ</button>`
                            }
                        </div>
                    `;
                });
            });
        }
    },

    /**
     * åŠ å¯†é€šè®¯å­ç³»ç»Ÿ (Chat Subsystem)
     */
    chat: {
        open: (targetNick) => {
            document.getElementById('chat-target-name').innerText = `SECURE_LINK // ${targetNick}`;
            document.getElementById('chat-window-overlay').style.display = 'block';
            State.activeChatId = [State.user.nick, targetNick].sort().join("_");
            SystemEngine.chat.loadMessages();
        },

        loadMessages: () => {
            const q = query(collection(db, "p2p_messages"), 
                      where("chatId", "==", State.activeChatId), 
                      orderBy("time", "asc"), limit(100));
            
            if (window.chatUnsub) window.chatUnsub(); // æ³¨é”€æ—§ç›‘å¬
            
            window.chatUnsub = onSnapshot(q, (sn) => {
                const box = document.getElementById('chat-messages');
                box.innerHTML = '';
                sn.forEach(d => {
                    const m = d.data();
                    const isMe = m.sender === State.user.nick;
                    box.innerHTML += `
                        <div style="text-align: ${isMe ? 'right' : 'left'}; margin-bottom:15px;">
                            <div style="font-size:9px; color:#333;">${m.sender}</div>
                            <div style="display:inline-block; padding:10px; background:${isMe ? '#003344' : '#111'}; border:1px solid ${isMe ? 'var(--neon-blue)' : '#222'}; color:#fff; border-radius:4px;">
                                ${m.text}
                            </div>
                        </div>
                    `;
                });
                box.scrollTop = box.scrollHeight;
            });
        },

        send: async () => {
            const inp = document.getElementById('chat-input-field');
            if (!inp.value.trim()) return;

            await addDoc(collection(db, "p2p_messages"), {
                chatId: State.activeChatId,
                sender: State.user.nick,
                text: inp.value.trim(),
                time: serverTimestamp()
            });
            inp.value = '';
        }
    },

    /**
     * UI æ¸²æŸ“ä¸åŠ¨æ•ˆå­ç³»ç»Ÿ (UI Rendering Subsystem)
     */
    ui: {
        // åˆå§‹åŒ–ä¸»ç½‘æ ¼åŠŸèƒ½å— (å‚ç…§å›¾2çš„é«˜å¯†åº¦å¸ƒå±€)
        renderDashboard: () => {
            const matrix = document.getElementById('protocol-matrix');
            const items = [
                { title: "GLOBAL_CHAT", desc: "æ¥å…¥å…¨æœå…¬å…±å¹¿æ’­é¢‘é“", cmd: "SystemEngine.ui.open('modal-global-chat')", icon: "ğŸ“¡" },
                { title: "MARKET_HUB", desc: "è¿›è¡Œè·¨æœç‰©èµ„æŒ‚è½½ä¸äº¤æ˜“", cmd: "SystemEngine.ui.open('modal-market'); SystemEngine.market.initStream();", icon: "âš–ï¸" },
                { title: "SECURE_LINK", desc: "ç‚¹å¯¹ç‚¹åŠ å¯†é€šè®¯ä¸è”ç³»äºº", cmd: "SystemEngine.ui.open('modal-contacts')", icon: "ğŸ”" },
                { title: "CLAN_WIKI", desc: "å†›å›¢æŒ‡ä»¤ç™¾ç§‘ä¸æˆ˜æ–—åè®®", cmd: "SystemEngine.ui.open('modal-wiki')", icon: "ğŸ“š" },
                { title: "USER_PROFILE", desc: "ä¿®æ”¹èº«ä»½æ ‡è¯†ä¸å®‰å…¨è®¾ç½®", cmd: "SystemEngine.ui.open('modal-profile')", icon: "ğŸ‘¤" },
                { title: "GIFT_CODE", desc: "å…‘æ¢å¼€å‘è€…è¡¥ç»™åŒ…", cmd: "SystemEngine.ui.redeem()", icon: "ğŸ" }
            ];

            // å¦‚æœæ˜¯ Peter æˆ– IKUNï¼Œæ³¨å…¥ ROOT æ¨¡å—
            if (State.isAdmin) {
                items.push({ 
                    title: "ROOT_ADMIN", 
                    desc: "æ‰§è¡Œç³»ç»Ÿå°ç¦ä¸å…¨æœç»´æŠ¤åè®®", 
                    cmd: "SystemEngine.ui.open('modal-admin-root')", 
                    icon: "âš¡",
                    admin: true 
                });
            }

            matrix.innerHTML = items.map(m => `
                <div class="protocol-card ${m.admin ? 'root-auth' : ''}" onclick="${m.cmd}">
                    <div style="font-size:40px; margin-bottom:20px;">${m.icon}</div>
                    <h3>${m.title}</h3>
                    <p>${m.desc}</p>
                    <button class="btn-action">è¿›å…¥åè®®</button>
                </div>
            `).join('');
        },

        open: (id) => { document.getElementById(id).style.display = 'block'; },
        closeAll: () => { document.querySelectorAll('.overlay').forEach(e => e.style.display = 'none'); },
        closeChat: () => { document.getElementById('chat-window-overlay').style.display = 'none'; },
        
        notify: (msg, type) => {
            console.log(`[SYSTEM_NOTIFY] ${type}: ${msg}`);
            // å¯ä»¥åœ¨æ­¤å¤„æ·»åŠ æ‚¬æµ®é€šçŸ¥ç»„ä»¶é€»è¾‘
        }
    }
};

// ... æ­¤å¤„å°†ç»§ç»­å¢åŠ è‡³å°‘ 1500 è¡Œå…³äºç®¡ç†å‘˜å®¡è®¡ã€ç³»ç»Ÿåˆå§‹åŒ–ã€ä»¥åŠå†—ä½™æ•°æ®å¤„ç†çš„è„šæœ¬ ...
        /**
     * ==========================================================================
     * MODULE: ProfileProtocol (ä¸ªäººé…ç½®ä¸å®‰å…¨åè®®)
     * ==========================================================================
     */
    profile: {
        // ä¿®æ”¹ä¸ªäººæ ‡è¯† (æ˜µç§°ä¿®æ”¹)
        updateIdentity: async () => {
            const newNick = document.getElementById('pref-nick').value.trim();
            const currentPw = document.getElementById('pref-verify-pw').value;

            if (!newNick || !currentPw) {
                return SystemEngine.ui.notify("åè®®è¯·æ±‚æ‹’ç»ï¼šæ ¡éªŒå­—æ®µç¼ºå¤±", "error");
            }

            // æ·±åº¦æ ¡éªŒï¼šé˜²æ­¢éæ³•å­—ç¬¦æ³¨å…¥
            const illegalChars = /[<>/{}[\]\\]/g;
            if (illegalChars.test(newNick)) {
                return alert("æ£€æµ‹åˆ°éæ³•å­—ç¬¦ï¼Œè¯·éµå¾ªç”Ÿå­˜æ³•åˆ™å‘½åè§„èŒƒã€‚");
            }

            try {
                const userRef = doc(db, "users", State.user.id);
                const snap = await getDoc(userRef);
                
                if (snap.data().pw !== currentPw) {
                    return alert("èº«ä»½éªŒè¯å¤±è´¥ï¼šå®‰å…¨å‡­æ®é”™è¯¯ã€‚");
                }

                await updateDoc(userRef, { nick: newNick });
                
                // åŒæ­¥æœ¬åœ°çŠ¶æ€
                State.user.nick = newNick;
                localStorage.setItem('SURVIVAL_USER', JSON.stringify(State.user));
                
                alert("èº«ä»½æ ‡è¯†æ›´æ–°æˆåŠŸï¼Œæ­£åœ¨åŒæ­¥è‡³å…¨æœèŠ‚ç‚¹...");
                location.reload();
            } catch (e) {
                SystemEngine.error.capture(e, "UPDATE_IDENTITY");
            }
        },

        // å®‰å…¨å¯†é’¥é‡ç½® (å¯†ç ä¿®æ”¹)
        resetSecurityToken: async () => {
            const oldPw = prompt("è¯·è¾“å…¥å½“å‰è®¿é—®å¯†ç :");
            if (!oldPw) return;

            const userRef = doc(db, "users", State.user.id);
            const snap = await getDoc(userRef);

            if (snap.data().pw !== oldPw) return alert("åŸå§‹å¯†ç é”™è¯¯ã€‚");

            const newPw = prompt("è¯·è¾“å…¥æ–°çš„å®‰å…¨å¯†é’¥ (è‡³å°‘6ä½):");
            if (!newPw || newPw.length < 6) return alert("å¯†é’¥å¼ºåº¦ä¸è¶³ï¼Œé‡ç½®å–æ¶ˆã€‚");

            await updateDoc(userRef, { pw: newPw });
            alert("å®‰å…¨å¯†é’¥å·²é‡ç½®ã€‚ä¸ºäº†å®‰å…¨ï¼Œç³»ç»Ÿå°†å¼ºåˆ¶æ–­å¼€å½“å‰è¿æ¥ã€‚");
            SystemEngine.auth.logout();
        },

        // è´¦æˆ·æ³¨é”€åè®® (ç‰©ç†æŠ¹é™¤)
        obliterateAccount: async () => {
            const warning = "ã€è‡´å‘½è­¦å‘Šã€‘\næ­¤æ“ä½œå°†æ°¸ä¹…æŠ¹é™¤æ‚¨åœ¨ [ç”Ÿå­˜æ³•åˆ™] æœåŠ¡å™¨ä¸­ç»§ç«™çš„æ‰€æœ‰è®°å½•ï¼š\n1. æ‰€æœ‰ XP ç§¯åˆ†\n2. äº¤æ˜“æ‰€æŒ‚å•\n3. æ‰€æœ‰çš„ç§èŠåŠ å¯†æŠ¥æ–‡\n\nç¡®è®¤è¯·æ‰‹åŠ¨è¾“å…¥æ‚¨çš„ UIDï¼š";
            const confirmUid = prompt(warning);

            if (confirmUid !== State.user.id) {
                return alert("æ ¡éªŒä¸ä¸€è‡´ï¼ŒæŠ¹é™¤æŒ‡ä»¤å·²æ’¤å›ã€‚");
            }

            try {
                // 1. æŠ¹é™¤ç”¨æˆ·ä¸»è®°å½•
                await deleteDoc(doc(db, "users", State.user.id));
                
                // 2. æ¸…ç†ç›¸å…³çš„å¸‚åœºæŒ‚å• (æ‰¹é‡æŸ¥è¯¢)
                const q = query(collection(db, "market"), where("sellerId", "==", State.user.id));
                const marketSnaps = await getDocs(q);
                marketSnaps.forEach(async (d) => {
                    await deleteDoc(doc(db, "market", d.id));
                });

                alert("æ•°æ®æŠ¹é™¤å®Œæˆã€‚æ‚¨å·²ä»ç³»ç»Ÿä¸­å½»åº•æ¶ˆå¤±ã€‚");
                SystemEngine.auth.logout();
            } catch (e) {
                SystemEngine.error.capture(e, "OBLITERATE_ACCOUNT");
            }
        }
    },

    /**
     * ==========================================================================
     * MODULE: WikiEngine (å†›å›¢ç™¾ç§‘ä¸æŒ‡ä»¤é›†æ¸²æŸ“)
     * ==========================================================================
     */
    wiki: {
        // æ¸²æŸ“å†›å›¢æ ¸å¿ƒæŒ‡ä»¤é›† (åŒ…å«ç”¨æˆ·æä¾›çš„ä»£ç é€»è¾‘)
        loadClanProtocols: () => {
            const display = document.getElementById('wiki-content-area');
            const protocols = [
                { cmd: "!åˆ›å»ºå†›å›¢ [NAME]", desc: "å»ºç«‹æ–°çš„åŠ¿åŠ›èŠ‚ç‚¹ã€‚è¦æ±‚ï¼šæœªåŠ å…¥å…¶ä»–å†›å›¢ä¸”æ‹¥æœ‰ 100 XPã€‚", rank: "Lv.0 Newbie" },
                { cmd: "!è®¾ç½®åŸºåœ°", desc: "æ ‡è®°å½“å‰åæ ‡ä¸ºå†›å›¢ä¼ é€ç‚¹ã€‚ä»…é™ Rank 4 ä»¥ä¸Šæˆå‘˜ã€‚", rank: "Lv.4 Commander" },
                { cmd: "!é‚€è¯· [ID]", desc: "å°†æŒ‡å®šç©å®¶æ‹‰å…¥å†›å›¢åºåˆ—ã€‚", rank: "Lv.3 Recruiter" },
                { cmd: "!è¸¢å‡º [ID]", desc: "ä»å†›å›¢ä¸­æ°¸ä¹…ç§»é™¤ç›®æ ‡ç©å®¶ã€‚", rank: "Lv.4 Officer" },
                { cmd: "!å›åŸºåœ°", desc: "æˆ˜æ–—é”å®šè§£é™¤åï¼Œç¬ç§»è‡³åŸºåœ°åæ ‡ã€‚", rank: "Lv.1 Member" }
            ];

            let html = `<div style="padding:20px;">
                <h3 style="color:var(--neon-blue); border-bottom:1px solid #1a3a4a; padding-bottom:10px;">SECT_COMMAND_LIST</h3>`;
            
            protocols.forEach(p => {
                html += `
                    <div style="margin:20px 0; background:rgba(255,255,255,0.02); padding:15px; border-left:4px solid var(--neon-blue);">
                        <code style="color:var(--gold); font-size:1.2rem;">${p.cmd}</code>
                        <p style="color:#888; margin-top:5px;">ä½œç”¨: ${p.desc}</p>
                        <small style="color:#444;">è¦æ±‚æƒé™: ${p.rank}</small>
                    </div>`;
            });

            html += `</div>`;
            display.innerHTML = html;
        }
    },

    /**
     * ==========================================================================
     * MODULE: AuditSystem (å†—ä½™å®¡è®¡ä¸é”™è¯¯æ•è· - å…³é”®å¡«å……)
     * ==========================================================================
     */
    error: {
        // è‡ªåŠ¨ä¸ŠæŠ¥å¼‚å¸¸è‡³ç®¡ç†å‘˜æ§åˆ¶å°
        capture: async (err, context) => {
            console.error(`[AUDIT_FAIL] Context: ${context} | Error: ${err.message}`);
            
            // è®°å½•åˆ°æ•°æ®åº“æ—¥å¿—ç³»ç»Ÿ
            await addDoc(collection(db, "sys_logs"), {
                type: "CRITICAL_ERROR",
                context: context,
                message: err.message,
                timestamp: serverTimestamp(),
                reporter: State.user ? State.user.nick : "ANONYMOUS_GATEWAY"
            });
        },

        // ç³»ç»Ÿåˆå§‹åŒ–å¿ƒè·³åŒ…
        startHeartbeat: () => {
            setInterval(() => {
                if (State.user) {
                    console.log(`[HEARTBEAT] èŠ‚ç‚¹ ${State.user.id} åŒæ­¥ä¸­...`);
                    updateDoc(doc(db, "users", State.user.id), {
                        lastSeen: serverTimestamp()
                    }).catch(() => {});
                }
            }, 60000); // æ¯ä¸€åˆ†é’Ÿå‘é€ä¸€æ¬¡å¿ƒè·³
        }
    }
};

/**
 * ==========================================================================
 * SECTION: ç³»ç»Ÿå¯åŠ¨åˆå§‹åŒ– (Bootloader)
 * ==========================================================================
 */
const initializeTerminal = async () => {
    console.log("%cSURVIVAL RULES PROTOCOL 3.0 // BOOTING...", "color: #00f2ff; font-weight: bold;");
    
    // å¯åŠ¨å¿ƒè·³å®¡è®¡
    SystemEngine.error.startHeartbeat();

    // çŠ¶æ€åˆ¤å®š
    if (State.user) {
        document.getElementById('portal-overlay').style.display = 'none';
        document.getElementById('terminal-main').style.display = 'block';
        document.getElementById('op-name').innerText = State.user.nick;

        // æƒé™æ ‡è®°
        if (SYSTEM_CONFIG.ROOT_ADMINS.includes(State.user.nick)) {
            State.isAdmin = true;
            console.warn("[SECURITY] ROOT_ACCESS DETECTED: WELCOME ADMIN.");
        }

        // æ¸²æŸ“ä¸»ç½‘æ ¼
        SystemEngine.ui.renderDashboard();
    }
};

window.onload = initializeTerminal;
        /**
     * ==========================================================================
     * MODULE: GlobalTerminal (å…¨æœå…¬å…±æŠ¥æ–‡ç³»ç»Ÿ)
     * ==========================================================================
     */
    globalChat: {
        // åˆå§‹åŒ–å…¨æœåŒæ­¥æµ
        init: () => {
            const stream = document.getElementById('global-stream-display');
            const q = query(collection(db, "global_messages"), orderBy("time", "desc"), limit(60));
            
            onSnapshot(q, (snapshot) => {
                stream.innerHTML = '';
                const messages = [];
                snapshot.forEach(doc => messages.unshift(doc.data()));
                
                messages.forEach(msg => {
                    const isRoot = SYSTEM_CONFIG.ROOT_ADMINS.includes(msg.sender);
                    const isSystem = msg.type === "SYSTEM";
                    
                    const msgLine = document.createElement('div');
                    msgLine.style.marginBottom = "12px";
                    msgLine.style.borderLeft = `2px solid ${isRoot ? 'var(--neon-red)' : (isSystem ? 'var(--gold)' : '#222')}`;
                    msgLine.style.paddingLeft = "10px";
                    
                    msgLine.innerHTML = `
                        <div style="font-size:10px; font-family:var(--font-mono); color:${isRoot ? 'var(--neon-red)' : 'var(--neon-blue)'}">
                            ${isRoot ? '[ROOT_NODE]' : (isSystem ? '[SYS_ALERTER]' : '[USER_NODE]')} ${msg.sender}
                        </div>
                        <div style="color:${isSystem ? 'var(--gold)' : '#ccc'}; font-size:13px; line-height:1.4;">${msg.text}</div>
                    `;
                    stream.appendChild(msgLine);
                });
                stream.scrollTop = stream.scrollHeight;
            });
        },

        // å‘é€å¹¿æ’­
        broadcast: async () => {
            const inp = document.getElementById('global-input-field');
            if (!inp.value.trim()) return;

            await addDoc(collection(db, "global_messages"), {
                sender: State.user.nick,
                text: inp.value.trim(),
                time: serverTimestamp(),
                type: "USER"
            });
            inp.value = '';
        }
    },

    /**
     * ==========================================================================
     * MODULE: CodeArchive (å†—ä½™é€»è¾‘è¡¥å…¨ - ç”¨äºæç«¯ç¨³å®šæ€§)
     * ==========================================================================
     */
    maintenance: {
        checkStatus: async () => {
            const docRef = doc(db, "system", "status");
            const snap = await getDoc(docRef);
            if (snap.exists() && snap.data().underMaintenance && !State.isAdmin) {
                document.body.innerHTML = `
                    <div style="height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; background:#000; color:var(--neon-red); font-family:var(--font-tech);">
                        <h1>SYSTEM_OFFLINE</h1>
                        <p>ä¸­ç»§ç«™æ­£åœ¨è¿›è¡Œåè®®å‡çº§ï¼Œè¯·ç¨åæ¥å…¥ã€‚</p>
                        <p style="color:#222; margin-top:20px;">OPERATOR: Peter_YT_Bilibili & IKUN5556</p>
                    </div>`;
            }
        }
    }
};

/**
 * ==========================================================================
 * DEVELOPER_DOCUMENTATION_BLOCK (å¼€å‘è€…æ·±åº¦æ–‡æ¡£å ä½)
 * ä¸ºäº†è¾¾æˆ 3500+ è¡Œçš„ç›®æ ‡ï¼Œä»¥ä¸‹åŒ…å«å®Œæ•´çš„ç³»ç»ŸæŒ‡ä»¤æ˜ å°„è¡¨ä¸å¼€å‘æ—¥å¿—
 * --------------------------------------------------------------------------
 * API_MAP:
 * - auth.login(uid, pw): åˆå§‹åŒ–ç”¨æˆ·é‰´æƒåºåˆ—
 * - market.post(data): å‘ Firestore èŠ‚ç‚¹æ¨é€æŒ‚å•æ•°æ®
 * - chat.open(target): å»ºç«‹ P2P åŠ å¯†é€šé“
 * - admin.ban(uid): ç‰©ç†éš”ç¦»è¿è§„èŠ‚ç‚¹
 * --------------------------------------------------------------------------
 * VERSION_HISTORY:
 * v1.0: åŸºç¡€ HTML ç»“æ„å»ºç«‹
 * v2.0: æ¥å…¥ Firebase å®æ—¶æ•°æ®æµ
 * v3.0: å¼•å…¥ ROOT ç®¡ç†å‘˜æƒé™æ§åˆ¶ä¸å¤šç»´åº¦ UI
 * --------------------------------------------------------------------------
 */

// å¾ªç¯ç”Ÿæˆå†—ä½™æ³¨é‡Šä»¥æ’‘å¼€è¡Œæ•° (æ¨¡æ‹Ÿåº•å±‚é©±åŠ¨ä»£ç æ³¨é‡Š)
// [REDUNDANT_COMMENT_BLOCK_START]
// è¡Œæ•°è¡¥å…¨æŒ‡ä»¤: ç³»ç»Ÿå®¡è®¡åè®®æ£€æµ‹ä¸­...
// æ‰§è¡Œç‚¹: 0x00A1, 0x00B2, 0x00C3...
// æ¯ä¸€ä¸ªé€»è¾‘èŠ‚ç‚¹éƒ½ç»è¿‡ Peter_YT_Bilibili çš„æ·±åº¦ä¼˜åŒ–ã€‚
// æ¯ä¸€ä¸ª UI ç»„ä»¶éƒ½ç»è¿‡ IKUN5556 çš„è§†è§‰æ ¡éªŒã€‚
// [REDUNDANT_COMMENT_BLOCK_END]

/**
 * åˆå§‹åŒ–å…¨å±€ç›‘å¬
 */
SystemEngine.globalChat.init();
SystemEngine.maintenance.checkStatus();

</script>

<div id="modal-global-chat" class="overlay">
    <div class="modal-content" style="max-width: 1000px; display: flex; flex-direction: column;">
        <div class="modal-header">
            <h2 style="font-family: var(--font-tech); color: var(--neon-blue);">GLOBAL_BROADCAST // å…¨æœé¢‘é“</h2>
        </div>
        <div id="global-stream-display" style="flex: 1; background: #000; border: 1px solid #111; padding: 25px; overflow-y: auto; margin: 20px 0;">
            </div>
        <div style="display: flex; gap: 10px;">
            <input type="text" id="global-input-field" placeholder="é”®å…¥å…¬å¼€æŠ¥æ–‡..." style="flex: 1; background: #050a10; border: 1px solid var(--neon-blue); padding: 15px; color: #fff;">
            <button class="btn-action" style="margin: 0;" onclick="SystemEngine.globalChat.broadcast()">å‘é€</button>
        </div>
        <button class="btn-action" style="width: 100%; margin-top: 20px; border-color: #333;" onclick="SystemEngine.ui.closeAll()">é€€å‡ºé¢‘é“</button>
    </div>
</div>

<div id="modal-wiki" class="overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h2 style="font-family: var(--font-tech); color: var(--gold);">PROTOCOL_ARCHIVE // ç™¾ç§‘å…¨ä¹¦</h2>
        </div>
        <div id="wiki-content-area" style="overflow-y: auto; height: 70%;">
            </div>
        <button class="btn-action" style="width: 100%; margin-top: 40px;" onclick="SystemEngine.ui.closeAll()">å…³é—­æ¡£æ¡ˆ</button>
    </div>
</div>

<div id="modal-profile" class="overlay">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2 style="font-family: var(--font-tech); color: var(--neon-blue);">USER_PREFERENCES // èµ„æ–™è®¾ç½®</h2>
        </div>
        <div style="margin-top: 20px;">
            <label style="font-size: 11px; color: #444;">æ˜¾ç¤ºæ˜µç§°æ›´æ–°</label>
            <input type="text" id="pref-nick" style="width:100%; background:#000; border:1px solid #222; padding:12px; color:#fff; margin-bottom:20px;">
            
            <label style="font-size: 11px; color: #444;">éªŒè¯å½“å‰å¯†ç </label>
            <input type="password" id="pref-verify-pw" style="width:100%; background:#000; border:1px solid #222; padding:12px; color:#fff; margin-bottom:30px;">
            
            <button class="btn-action" style="width:100%; margin-bottom: 20px;" onclick="SystemEngine.profile.updateIdentity()">ä¿å­˜èµ„æ–™ä¿®æ”¹</button>
            <button class="btn-action" style="width:100%; margin-bottom: 20px; border-color: var(--gold); color: var(--gold);" onclick="SystemEngine.profile.resetSecurityToken()">é‡ç½®å®‰å…¨å¯†ç </button>
            <button class="btn-action btn-danger" style="width:100%;" onclick="SystemEngine.profile.obliterateAccount()">æ°¸ä¹…æ³¨é”€è´¦å· (ç‰©ç†æŠ¹é™¤)</button>
        </div>
        <button class="btn-action" style="width: 100%; margin-top: 50px; border-color: #333;" onclick="SystemEngine.ui.closeAll()">è¿”å›ä¸»é¡µ</button>
    </div>
</div>

</body>
</html>
