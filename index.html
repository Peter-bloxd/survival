<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿå­˜æ³•åˆ™ - å®˜æ–¹ç¤¾åŒº</title>
    <style>
        :root { --main-green: #2ecc71; --accent-blue: #3498db; --bg: #05080a; --card-bg: rgba(22, 27, 34, 0.7); }
        body { background: var(--bg); color: white; font-family: 'Poppins', 'PingFang SC', sans-serif; margin: 0; overflow-x: hidden; }
        
        /* åŠ¨æ€èƒŒæ™¯ */
        body::before { content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% 50%, #1a2c22 0%, #05080a 70%); z-index: -1; }

        /* å¯¼èˆªæ ç¾åŒ– */
        nav { display: flex; justify-content: space-between; padding: 20px 50px; align-items: center; background: rgba(13, 17, 23, 0.8); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255,255,255,0.1); position: sticky; top: 0; z-index: 100; }
        .logo { color: var(--main-green); font-size: 26px; font-weight: 800; text-decoration: none; letter-spacing: 1px; text-shadow: 0 0 10px rgba(46, 204, 113, 0.3); }
        
        /* æŒ‰é’®æ ·å¼ */
        .auth-btn { background: linear-gradient(135deg, var(--main-green), #27ae60); color: black; border: none; padding: 10px 24px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; box-shadow: 0 4px 15px rgba(46, 204, 113, 0.2); }
        .auth-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4); }

        /* ç£è´´ç½‘æ ¼ - é«˜çº§è´¨æ„Ÿ */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; max-width: 1200px; margin: 40px auto; padding: 0 20px; }
        .card { background: var(--card-bg); padding: 30px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(5px); cursor: pointer; transition: 0.4s; position: relative; overflow: hidden; }
        .card::after { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(45deg, transparent, rgba(46, 204, 113, 0.1)); opacity: 0; transition: 0.3s; }
        .card:hover { border-color: var(--main-green); transform: translateY(-8px); background: rgba(22, 27, 34, 0.9); }
        .card:hover::after { opacity: 1; }
        .card h3 { margin: 0 0 10px 0; font-size: 20px; color: var(--main-green); }
        .card p { color: #8b949e; line-height: 1.6; margin: 0; }

        /* æç¤ºç³»ç»Ÿ (Toast) */
        #toast-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 9999; }
        .toast { background: rgba(46, 204, 113, 0.9); color: black; padding: 12px 30px; border-radius: 50px; font-weight: bold; margin-top: 10px; animation: fadeInUp 0.4s ease, fadeOut 0.4s ease 2.6s; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* èŠå¤©å®¤ */
        #chat-panel { display: none; position: fixed; bottom: 90px; right: 30px; width: 380px; height: 550px; background: #0d1117; border: 1px solid var(--main-green); border-radius: 16px; flex-direction: column; z-index: 1000; box-shadow: 0 10px 40px rgba(0,0,0,0.6); }
        #chat-header { padding: 15px 20px; background: #161b22; border-bottom: 1px solid #30363d; border-radius: 16px 16px 0 0; display: flex; justify-content: space-between; align-items: center; }
        #chat-messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        .msg { background: #1c2128; padding: 10px 15px; border-radius: 12px; font-size: 14px; max-width: 80%; border-left: 3px solid var(--main-green); }
        .msg b { display: block; font-size: 11px; margin-bottom: 4px; opacity: 0.6; }

        /* ç™»å½•æ¡† */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); z-index: 2000; }
        .modal { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #161b22; padding: 40px; border-radius: 20px; width: 340px; border: 1px solid rgba(46, 204, 113, 0.3); }
        .input-group { position: relative; margin-bottom: 20px; }
        .modal input { width: 100%; padding: 14px; background: #0d1117; border: 1px solid #30363d; color: white; border-radius: 10px; box-sizing: border-box; outline: none; transition: 0.3s; }
        .modal input:focus { border-color: var(--main-green); }
        .eye-btn { position: absolute; right: 15px; top: 15px; cursor: pointer; filter: grayscale(1); }
    </style>
</head>
<body>

<div id="toast-container"></div>

<nav>
    <a href="#" class="logo">ç”Ÿå­˜æ³•åˆ™ Â· ç¤¾åŒº</a>
    <div id="auth-ui"></div>
</nav>

<div style="text-align:center; padding: 80px 20px;">
    <h1 style="font-size: 56px; margin: 0; background: linear-gradient(to bottom, #fff, #888); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">ç”Ÿå­˜æ³•åˆ™</h1>
    <p style="color: #8b949e; font-size: 20px; margin-top: 15px;">åœ¨è¿™ä¸ªå……æ»¡å±é™©çš„ä¸–ç•Œä¸­ï¼Œæ´»ä¸‹å»æ˜¯å”¯ä¸€çš„åˆè¡·</p>
</div>

<div class="grid">
    <div class="card" onclick="openChat()"><h3>ğŸ’¬ ç»„é˜Ÿå¤§å…</h3><p>å®æ—¶åœ¨çº¿èŠå¤©ï¼Œå¯»æ‰¾å¯é çš„ç”Ÿå­˜ä¼™ä¼´</p></div>
    <div class="card" onclick="notify('ğŸ“š ç©æ³•ä»‹ç»ï¼šæ¢ç´¢åœ°å›¾ã€æœåˆ®ç‰©èµ„å¹¶å¯»æ‰¾æ’¤ç¦»ç‚¹ã€‚')"><h3>ğŸ“œ ç©æ³•ä»‹ç»</h3><p>äº†è§£æœåŠ¡å™¨æ ¸å¿ƒè§„åˆ™ä¸ç”Ÿå­˜æŠ€å·§</p></div>
    <div class="card" onclick="notify('ğŸ› ï¸ äº¤æ˜“è¡Œï¼šå³å°†æ”¯æŒç©å®¶é—´çš„ç‰©èµ„å®‰å…¨äº¤æ˜“ã€‚')"><h3>âš–ï¸ äº¤æ˜“è¡Œ</h3><p>å®‰å…¨çš„ç‰©èµ„äº’æ¢ä¸è´¢å¯Œç§¯ç´¯ä¸­å¿ƒ</p></div>
    <div class="card" onclick="notify('ğŸ å…‘æ¢ç ï¼šæš‚æ— å¯ç”¨çš„å…¨çƒå…‘æ¢ç ã€‚')"><h3>ğŸ’ å…‘æ¢ç </h3><p>é¢†å–é™æ—¶ç‰©èµ„å¥–åŠ±ä¸ä¸“å±çš®è‚¤</p></div>
</div>

<div id="chat-panel">
    <div id="chat-header"><span>ğŸŒ ç»„é˜Ÿå¤§å…èŠå¤©å®¤</span><span onclick="closeChat()" style="cursor:pointer">âœ•</span></div>
    <div id="chat-messages"></div>
    <div style="padding:15px; display:flex; gap:10px; border-top:1px solid #30363d;">
        <input type="text" id="msg-input" placeholder="è¾“å…¥æ¶ˆæ¯..." style="flex:1; background:#0d1117; border:1px solid #30363d; color:white; padding:10px; border-radius:8px;">
        <button class="auth-btn" onclick="sendMsg()">å‘é€</button>
    </div>
</div>

<div class="modal-overlay" id="modal-overlay">
    <div class="modal">
        <div style="display:flex; gap:20px; margin-bottom:30px; justify-content:center;">
            <span id="tab-login" style="cursor:pointer; font-weight:bold" onclick="switchTab('login')">ç™»å½•</span>
            <span id="tab-reg" style="cursor:pointer; color:#8b949e" onclick="switchTab('reg')">æ³¨å†Œ</span>
        </div>
        <div id="nick-box" style="display:none" class="input-group"><input type="text" id="auth-nick" placeholder="æ¸¸æˆæ˜µç§°"></div>
        <div class="input-group"><input type="text" id="auth-id" placeholder="ç™»å½• ID"></div>
        <div class="input-group">
            <input type="password" id="auth-pw" placeholder="å¯†ç ">
            <span class="eye-btn" onclick="togglePw()">ğŸ‘ï¸</span>
        </div>
        <button class="auth-btn" style="width:100%" onclick="doAuth()">ç¡®å®š</button>
        <p onclick="closeModal()" style="text-align:center; color:#8b949e; cursor:pointer; font-size:13px; margin-top:15px;">ç¨åå†è¯´</p>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, limit, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBC92jwiCLsfG6bE4k2Jo4KQSiI-A_gxII",
        authDomain: "bloxd-survival.firebaseapp.com",
        projectId: "bloxd-survival",
        storageBucket: "bloxd-survival.firebasestorage.app",
        messagingSenderId: "60666065786",
        appId: "1:60666065786:web:bdc3131accaceb0180dcc3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let currentUser = JSON.parse(localStorage.getItem('user_v2'));
    let authMode = 'login';

    // ç™»å½•/æ³¨å†Œé€»è¾‘æ›´æ–°
    window.doAuth = () => {
        const id = document.getElementById('auth-id').value.trim();
        const pw = document.getElementById('auth-pw').value;
        const nick = document.getElementById('auth-nick').value;

        if(!id || !pw) return notify("è¯·å¡«å†™å®Œæ•´ï¼");

        if(authMode === 'reg') {
            if(!nick) return notify("è¯·è¾“å…¥æ˜µç§°ï¼");
            // æ£€æŸ¥ ID æ˜¯å¦å·²å­˜åœ¨
            if(localStorage.getItem('saved_u_' + id)) return notify("âŒ è¯¥ ID å·²è¢«æ³¨å†Œï¼Œè¯·æ›´æ¢ï¼");
            
            const user = { id, pw, nick };
            localStorage.setItem('saved_u_' + id, JSON.stringify(user));
            login(user);
        } else {
            const saved = localStorage.getItem('saved_u_' + id);
            if(!saved) return notify("è´¦å·ä¸å­˜åœ¨ï¼");
            const user = JSON.parse(saved);
            if(user.pw !== pw) return notify("å¯†ç é”™è¯¯ï¼");
            login(user);
        }
    };

    function login(user) {
        localStorage.setItem('user_v2', JSON.stringify(user));
        currentUser = user;
        closeModal();
        updateUI();
        notify("âœ¨ æ¬¢è¿è¿›å…¥ç”Ÿå­˜æ³•åˆ™ï¼Œ" + user.nick);
    }

    //
