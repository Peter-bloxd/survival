<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿå­˜æ³•åˆ™ - å®˜æ–¹ç¤¾åŒº</title>
    <style>
        :root { --main-green: #2ecc71; --card-bg: #161b22; --border: #30363d; }
        body { background-color: #0d1117; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; overflow-x: hidden; }
        
        /* å¯¼èˆªä¸åŸºç¡€æ ·å¼ */
        nav { display: flex; justify-content: space-between; padding: 15px 30px; align-items: center; background: #161b22; border-bottom: 1px solid var(--border); }
        .logo { color: var(--main-green); font-size: 22px; font-weight: bold; text-decoration: none; }
        .auth-btn { background: var(--main-green); color: black; border: none; padding: 8px 18px; border-radius: 5px; cursor: pointer; font-weight: bold; }

        /* é€šçŸ¥ç³»ç»Ÿ (æ›¿ä»£ Alert) */
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
        .toast { background: #21262d; border-left: 4px solid var(--main-green); color: white; padding: 15px 25px; margin-bottom: 10px; border-radius: 4px; box-shadow: 0 4px 12px rgba(0,0,0,0.5); animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        /* èŠå¤©å®¤é¢æ¿ */
        #chat-panel { display: none; position: fixed; bottom: 20px; right: 20px; width: 350px; height: 500px; background: #161b22; border: 1px solid var(--main-green); border-radius: 10px; flex-direction: column; z-index: 1000; }
        #chat-header { padding: 10px; background: #21262d; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; }
        #chat-messages { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 8px; }
        .msg { background: #30363d; padding: 8px; border-radius: 5px; max-width: 80%; font-size: 14px; }
        .msg b { color: var(--main-green); display: block; font-size: 12px; }
        #chat-input-area { padding: 10px; display: flex; gap: 5px; border-top: 1px solid var(--border); }
        #chat-input-area input { flex: 1; background: #0d1117; border: 1px solid var(--border); color: white; padding: 5px; border-radius: 3px; }

        /* ç½‘æ ¼å¸ƒå±€ */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; max-width: 1100px; margin: 40px auto; padding: 0 20px; }
        .card { background: #161b22; padding: 25px; border-radius: 8px; border: 1px solid var(--border); cursor: pointer; transition: 0.3s; }
        .card:hover { border-color: var(--main-green); transform: translateY(-3px); }

        /* æ³¨å†Œå¼¹çª— */
        .modal-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index: 2000; }
        .modal { position: absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:#21262d; padding:30px; border-radius:10px; width:300px; border:1px solid var(--main-green); }
        .modal input { width:100%; margin: 10px -10px; padding:10px; background:#0d1117; border:1px solid var(--border); color:white; border-radius:5px; }
    </style>
</head>
<body>

<div id="toast-container"></div>

<nav>
    <a href="#" class="logo">ç”Ÿå­˜æ³•åˆ™ Â· ç¤¾åŒº</a>
    <div id="auth-ui"></div>
</nav>

<div class="grid">
    <div class="card" onclick="openChat()"><h3>ğŸ’¬ ç»„é˜Ÿå¤§å…</h3><p>å®æ—¶åœ¨çº¿èŠå¤©ï¼Œå¯»æ‰¾é˜Ÿå‹</p></div>
    <div class="card" onclick="notify('äº¤æ˜“è¡Œç³»ç»Ÿç»´æŠ¤ä¸­ï¼Œé¢„è®¡æ˜å¤©å¼€æ”¾')"><h3>âš–ï¸ äº¤æ˜“è¡Œ</h3><p>ç©å®¶ç‰©èµ„äº’æ¢ä¸­å¿ƒ</p></div>
    <div class="card" onclick="notify('æš‚æ— å¯ç”¨å…‘æ¢ç ')"><h3>ğŸ å…‘æ¢ç </h3><p>é¢†å–ç¤¾åŒºä¸“å±ç¤¼åŒ…</p></div>
</div>

<div id="chat-panel">
    <div id="chat-header">
        <span>ç»„é˜Ÿå¤§å…èŠå¤©å®¤</span>
        <button onclick="closeChat()" style="background:none; border:none; color:white; cursor:pointer;">âœ–</button>
    </div>
    <div id="chat-messages"></div>
    <div id="chat-input-area">
        <input type="text" id="msg-input" placeholder="è¾“å…¥æ¶ˆæ¯...">
        <button class="auth-btn" onclick="sendMsg()" style="padding:5px 10px">å‘é€</button>
    </div>
</div>

<div class="modal-overlay" id="modal-overlay">
    <div class="modal">
        <h3 style="margin:0">åˆ›å»ºè´¦å·</h3>
        <input type="text" id="reg-name" placeholder="æ¸¸æˆæ˜µç§°">
        <input type="text" id="reg-id" placeholder="ç™»å½• ID">
        <input type="password" id="reg-pw" placeholder="å¯†ç ">
        <button class="auth-btn" style="width:100%; margin-top:10px" onclick="doRegister()">ç¡®å®šæ³¨å†Œ</button>
    </div>
</div>

<script type="module">
    // å¼•å…¥ Firebase åŠŸèƒ½
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, limit, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBC92jwiCLsfG6bE4k2Jo4KQSiI-A_gxII", // å·²æ›´æ­£æ‹¼å†™
        authDomain: "bloxd-survival.firebaseapp.com",
        projectId: "bloxd-survival",
        storageBucket: "bloxd-survival.firebasestorage.app",
        messagingSenderId: "60666065786",
        appId: "1:60666065786:web:bdc3131accaceb0180dcc3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let currentUser = JSON.parse(localStorage.getItem('user'));

    // è‡ªå®šä¹‰é€šçŸ¥å‡½æ•° (æ›¿ä»£ Alert)
    window.notify = (text) => {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.innerText = text;
        container.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    };

    // ç™»å½•ç•Œé¢æ›´æ–°
    window.updateUI = () => {
        const ui = document.getElementById('auth-ui');
        if(currentUser) {
            ui.innerHTML = `<span style="margin-right:15px">${currentUser.name}</span><button class="auth-btn" onclick="logout()" style="background:#e74c3c">é€€å‡º</button>`;
        } else {
            ui.innerHTML = `<button class="auth-btn" onclick="showReg()">æ³¨å†Œ / ç™»å½•</button>`;
        }
    };

    window.showReg = () => document.getElementById('modal-overlay').style.display = 'block';
    window.logout = () => { localStorage.removeItem('user'); location.reload(); };

    window.doRegister = () => {
        const name = document.getElementById('reg-name').value;
        const id = document.getElementById('reg-id').value;
        if(!name || !id) return notify("è¯·å¡«å†™å®Œæ•´ï¼");
        currentUser = { name, id };
        localStorage.setItem('user', JSON.stringify(currentUser));
        document.getElementById('modal-overlay').style.display = 'none';
        notify("æ¬¢è¿åŠ å…¥, " + name);
        updateUI();
    };

    // èŠå¤©å®¤é€»è¾‘
    window.openChat = () => {
        if(!currentUser) return notify("è¯·å…ˆæ³¨å†Œ/ç™»å½•è´¦å·ï¼");
        document.getElementById('chat-panel').style.display = 'flex';
        loadMessages();
    };
    window.closeChat = () => document.getElementById('chat-panel').style.display = 'none';

    function loadMessages() {
        const q = query(collection(db, "messages"), orderBy("createdAt", "asc"), limit(50));
        onSnapshot(q, (snapshot) => {
            const box = document.getElementById('chat-messages');
            box.innerHTML = '';
            snapshot.forEach(doc => {
                const data = doc.data();
                const div = document.createElement('div');
                div.className = 'msg';
                div.innerHTML = `<b>${data.user}</b>${data.text}`;
                box.appendChild(div);
            });
            box.scrollTop = box.scrollHeight;
        });
    }

    window.sendMsg = async () => {
        const input = document.getElementById('msg-input');
        if(!input.value) return;
        try {
            await addDoc(collection(db, "messages"), {
                text: input.value,
                user: currentUser.name,
                createdAt: serverTimestamp()
            });
            input.value = '';
        } catch (e) {
            notify("å‘é€å¤±è´¥ï¼Œè¯·ç¡®ä¿å·²å¼€å¯ Firestore æ•°æ®åº“");
        }
    };

    updateUI();
</script>
</body>
</html>
